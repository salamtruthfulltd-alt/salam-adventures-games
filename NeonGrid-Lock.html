<!DOCTYPE html>
<html>
<head>
    <title>Neon Grid-Lock: Star Edition</title>
    <style>
        :root { --neon: #00f2ff; --pink: #ff00de; --gold: #ffcc00; --bg: #050505; }
        body { background: var(--bg); color: white; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        
        #game-box { border: 5px solid var(--neon); padding: 20px; border-radius: 20px; background: #111; text-align: center; width: 400px; position: relative; animation: glow 2s infinite alternate; }
        @keyframes glow { from { box-shadow: 0 0 10px var(--neon); } to { box-shadow: 0 0 30px var(--pink); } }

        .stats { display: flex; justify-content: space-around; background: #000; padding: 10px; border-radius: 10px; border: 1px solid #333; margin-bottom: 10px; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 250px; margin: 20px auto; }
        .tile { width: 75px; height: 75px; background: #222; border: 2px solid #444; border-radius: 10px; cursor: pointer; }
        .tile.active { background: var(--pink); box-shadow: 0 0 20px var(--pink); }
        .tile.pressed { background: var(--neon); box-shadow: 0 0 20px var(--neon); }

        /* Victory Star Overlay */
        #victory-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; border-radius: 15px; }
        .star-row { font-size: 3.5rem; color: var(--gold); margin-bottom: 10px; animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        .btn { background: var(--neon); color: black; border: none; padding: 15px; font-weight: bold; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1rem; }
        table { width: 100%; font-size: 0.8rem; margin-top: 15px; border-top: 1px solid #333; }
        th { color: var(--neon); padding-top: 10px; }
    </style>
</head>
<body onload="renderBoard()">

<div id="game-box">
    <h2 id="msg" style="margin:0">GRID-LOCK V1.0</h2>
    
    <div class="stats">
        <div>⏳ <span id="timer">60</span>s</div>
        <div style="color:var(--gold)">PTS: <span id="pts">0</span></div>
        <div>LVL: <span id="lvl">1</span></div>
    </div>

    <div id="screen" style="position:relative;">
        <div id="victory-layer">
            <div class="star-row" id="stars">★ ★ ★</div>
            <h2 id="vic-text" style="color:var(--gold)">LEVEL COMPLETE</h2>
            <button class="btn" style="width:80%; background:var(--gold)" onclick="nextLevel()">CONTINUE</button>
        </div>

        <div class="grid" id="grid"></div>
    </div>

    <div id="controls">
        <button id="start-btn" class="btn" onclick="startGame()">INITIALIZE SYSTEM</button>
    </div>

    <table>
        <thead><tr><th>RANK</th><th>PILOT</th><th>SCORE</th></tr></thead>
        <tbody id="board-body"></tbody>
    </table>
</div>

<script>
    let game = {
        lvl: 1, score: 0, time: 60, pattern: [], userIdx: 0, active: false, goal: 2000
    };
    let clock = null;

    function createGrid() {
        const g = document.getElementById('grid');
        g.innerHTML = '';
        for(let i=0; i<9; i++) {
            let t = document.createElement('div');
            t.className = 'tile';
            t.id = 't'+i;
            t.onclick = () => handleInput(i);
            g.appendChild(t);
        }
    }

    function startGame() {
        game = { lvl: 1, score: 0, time: 60, pattern: [], userIdx: 0, active: true, goal: 1500 };
        document.getElementById('pts').innerText = "0";
        document.getElementById('lvl').innerText = "1";
        document.getElementById('start-btn').style.display = 'none';
        if(clock) clearInterval(clock);
        clock = setInterval(tick, 1000);
        newPattern();
    }

    function tick() {
        game.time--;
        document.getElementById('timer').innerText = game.time;
        if(game.time <= 0) endGame();
    }

    async function newPattern() {
        game.active = false;
        game.userIdx = 0;
        game.pattern = [];
        document.getElementById('msg').innerText = "WATCH...";
        
        let length = 2 + game.lvl;
        for(let i=0; i<length; i++) game.pattern.push(Math.floor(Math.random()*9));

        for(let id of game.pattern) {
            await flash(id);
            await new Promise(r => setTimeout(r, 200));
        }
        game.active = true;
        document.getElementById('msg').innerText = "REPEAT!";
    }

    function flash(id) {
        return new Promise(r => {
            const t = document.getElementById('t'+id);
            t.classList.add('active');
            setTimeout(() => { t.classList.remove('active'); r(); }, 600 - (game.lvl * 30));
        });
    }

    function handleInput(id) {
        if(!game.active) return;
        const t = document.getElementById('t'+id);
        t.classList.add('pressed');
        setTimeout(() => t.classList.remove('pressed'), 200);

        if(id === game.pattern[game.userIdx]) {
            game.userIdx++;
            if(game.userIdx === game.pattern.length) {
                game.score += 500;
                document.getElementById('pts').innerText = game.score;
                if(game.score >= game.goal) showVictory();
                else newPattern();
            }
        } else {
            document.getElementById('msg').innerText = "ERROR! TRY AGAIN";
            game.userIdx = 0;
            setTimeout(newPattern, 800);
        }
    }

    function showVictory() {
        game.active = false;
        const vic = document.getElementById('victory-layer');
        const starEl = document.getElementById('stars');
        
        // Stars based on time remaining
        let stars = "★";
        if(game.time > 20) stars = "★ ★";
        if(game.time > 40) stars = "★ ★ ★";
        
        starEl.innerText = stars;
        vic.style.display = 'flex';
    }

    function nextLevel() {
        game.lvl++;
        game.goal += 1000;
        game.time += 20; // Time bonus
        document.getElementById('lvl').innerText = game.lvl;
        document.getElementById('victory-layer').style.display = 'none';
        newPattern();
    }

    function endGame() {
        clearInterval(clock);
        game.active = false;
        let n = prompt("SYSTEM OVERRIDE. Final Score: " + game.score + "\nEnter Callsign:");
        if(n) save(n, game.score);
        location.reload();
    }

    function save(n, s) {
        let b = JSON.parse(localStorage.getItem('neon_grid_scores') || '[]');
        b.push({n: n.toUpperCase().substring(0,10), s: s});
        b.sort((a,b) => b.s - a.s);
        localStorage.setItem('neon_grid_scores', JSON.stringify(b.slice(0,10)));
    }

    function renderBoard() {
        createGrid();
        let b = JSON.parse(localStorage.getItem('neon_grid_scores') || '[]');
        document.getElementById('board-body').innerHTML = b.map((x, i) => 
            `<tr><td>#${i+1}</td><td>${x.n}</td><td>${x.s}</td></tr>`).join('');
    }
</script>
</body>
</html>

<div class="puzzleWrap">
  <div class="puzzleControls">
    <div class="btnrow">
      <button id="p3x2">3×2</button>
      <button id="p2x2" class="secondary">2×2</button>
      <button id="pshuffle" class="secondary">Shuffle</button>
    </div>
    <div id="pstatus" class="pstatus">Drag a tile onto another to swap.</div>
  </div>

  <div id="pboard" class="pboard"></div>
</div>

<style>
  .puzzleWrap{ width:min(780px, 94vw); display:grid; gap:14px; margin:0 auto; }
  .puzzleControls{ display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center; }
  .btnrow{ display:flex; gap:10px; flex-wrap:wrap; }
  .btnrow button{ border:0; padding:10px 14px; border-radius:999px; background:#111; color:#fff; cursor:pointer; font-weight:700; }
  .btnrow button.secondary{ background:#fff; color:#111; box-shadow: inset 0 0 0 2px #111; }

  .pstatus{ font-size:14px; opacity:.9; }

  .pboard{
    width:100%;
    background:#fff;
    border-radius:18px;
    box-shadow: 0 10px 30px rgba(0,0,0,.12);
    padding:8px;
    box-sizing:border-box;
    display:grid;
    gap:8px;
    user-select:none;
    touch-action:none;
    min-height:240px;
  }

  .ptile{
    border-radius:14px;
    overflow:hidden;
    box-shadow: 0 6px 14px rgba(0,0,0,.10);
    border: 1px solid rgba(0,0,0,.08);
    background:#eef1f8;
    cursor: grab;
    width:100%;
    height:100%;
    position:relative;
  }
  .ptile:active{ cursor:grabbing; }
  .ptile.dragging{ opacity:.92; outline: 3px solid rgba(17,17,17,.20); z-index:9999; }

  .ptile img{
    width:100%;
    height:100%;
    object-fit: cover;       /* ✅ never distorts */
    display:block;
    pointer-events:none;     /* ✅ dragging the tile, not the image */
    user-drag:none;
    -webkit-user-drag:none;
  }
</style>

<script>
(() => {
  const board = document.getElementById("pboard");
  const statusEl = document.getElementById("pstatus");

  const btn3x2 = document.getElementById("p3x2");
  const btn2x2 = document.getElementById("p2x2");
  const btnShuffle = document.getElementById("pshuffle");

  // ✅ PUT YOUR REAL PIECE FILENAMES HERE (these are examples)
  // 3×2 = 6 pieces in correct solved order (left→right, top→bottom)
  const PIECES_3x2 = [
    "images/puzzle/3x2_1.jpg",
    "images/puzzle/3x2_2.jpg",
    "images/puzzle/3x2_3.jpg",
    "images/puzzle/3x2_4.jpg",
    "images/puzzle/3x2_5.jpg",
    "images/puzzle/3x2_6.jpg"
  ];

  // 2×2 = 4 pieces in correct solved order
  const PIECES_2x2 = [
    "images/puzzle/2x2_1.jpg",
    "images/puzzle/2x2_2.jpg",
    "images/puzzle/2x2_3.jpg",
    "images/puzzle/2x2_4.jpg"
  ];

  let pieces = PIECES_3x2;
  let cols = 3, rows = 2;
  let order = [];
  let draggingIndex = null;

  function setMode(c, r, arr){
    cols = c; rows = r; pieces = arr;

    board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    board.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
    board.style.aspectRatio = `${cols}/${rows}`;

    btn3x2.classList.toggle("secondary", !(cols===3 && rows===2));
    btn2x2.classList.toggle("secondary", !(cols===2 && rows===2));

    order = Array.from({length: pieces.length}, (_,i)=>i);
    shuffle();
    render();
  }

  function shuffle(){
    for(let i=order.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [order[i], order[j]] = [order[j], order[i]];
    }
  }

  function render(){
    board.innerHTML = "";
    for(let i=0;i<order.length;i++){
      const idx = order[i];

      const tile = document.createElement("div");
      tile.className = "ptile";
      tile.draggable = true;
      tile.dataset.pos = String(i);

      const img = document.createElement("img");
      img.src = pieces[idx];
      img.alt = "Puzzle piece";
      tile.appendChild(img);

      tile.addEventListener("dragstart", onDragStart);
      tile.addEventListener("dragend", onDragEnd);
      tile.addEventListener("dragover", e => e.preventDefault());
      tile.addEventListener("drop", onDrop);

      board.appendChild(tile);
    }
    checkSolved();
  }

  function checkSolved(){
    const ok = order.every((id, i) => id === i);
    statusEl.textContent = ok ? "✅ Solved!" : "Drag a tile onto another to swap.";
  }

  function onDragStart(e){
    const tile = e.currentTarget;
    draggingIndex = [...board.children].indexOf(tile);

    // ✅ lock size so it can’t stretch
    const rect = tile.getBoundingClientRect();
    tile.style.width = rect.width + "px";
    tile.style.height = rect.height + "px";

    tile.classList.add("dragging");
    e.dataTransfer.effectAllowed = "move";
  }

  function onDragEnd(e){
    const tile = e.currentTarget;
    tile.classList.remove("dragging");
    tile.style.width = "";
    tile.style.height = "";
    draggingIndex = null;
  }

  function onDrop(e){
    e.preventDefault();
    if(draggingIndex === null) return;
    const dropIndex = [...board.children].indexOf(e.currentTarget);
    if(dropIndex === draggingIndex) return;

    [order[draggingIndex], order[dropIndex]] = [order[dropIndex], order[draggingIndex]];
    render();
  }

  btn3x2.addEventListener("click", () => setMode(3,2,PIECES_3x2));
  btn2x2.addEventListener("click", () => setMode(2,2,PIECES_2x2));
  btnShuffle.addEventListener("click", () => { shuffle(); render(); });

  // start
  setMode(3,2,PIECES_3x2);
})();
</script>

<!-- âœ… Replace your WHOLE puzzle.html with this.
     Uses ONLY these 3 PNGs (exact filenames):
     1) star.png
     2) balloon.png
     3) salam.png
     Fixes flashing by removing ALL border animations + any hue/flash effects.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Salam Adventures: Picture Puzzle Play</title>
  <style>
    :root{
      --ink:#111827;
      --muted:#6b7280;
      --panel: rgba(255,255,255,.92);
      --shadow: 0 26px 80px rgba(0,0,0,.16);
      --shadow2: 0 16px 34px rgba(0,0,0,.14);
      --radius: 22px;

      /* âœ… STATIC border (NO animation) */
      --borderGrad: conic-gradient(from 180deg,
        #ff5fa2, #ffd54a, #4cc9ff, #63f5a6, #8b7cff, #ff9b3a, #ff5fa2
      );
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 10% 10%, #ffffffaa 0, transparent 55%),
        radial-gradient(900px 650px at 90% 10%, #ffffffaa 0, transparent 50%),
        linear-gradient(120deg, #fde7ef, #e6f4ff);
      overflow:hidden;
    }

    .wrap{height:100%;display:flex;align-items:center;justify-content:center;padding:16px}

    /* âœ… 3D frame but STATIC (no pulsing / spinning / flashing) */
    .frame{
      width:min(1100px, 100%);
      height:min(760px, 100%);
      border-radius: calc(var(--radius) + 12px);
      padding:10px;
      background: var(--borderGrad);
      box-shadow: var(--shadow);
      position:relative;
      transform: translateZ(0);
    }
    .frame::before{
      content:"";
      position:absolute;
      inset:6px;
      border-radius: calc(var(--radius) + 8px);
      pointer-events:none;
      background:
        radial-gradient(7px 7px at 12% 18%, rgba(255,255,255,.55) 0 55%, transparent 58%),
        radial-gradient(6px 6px at 88% 22%, rgba(255,255,255,.50) 0 55%, transparent 58%),
        radial-gradient(5px 5px at 70% 85%, rgba(255,255,255,.45) 0 55%, transparent 58%),
        radial-gradient(6px 6px at 25% 78%, rgba(255,255,255,.45) 0 55%, transparent 58%);
      mix-blend-mode: screen;
      opacity:.75;
    }

    .card{
      height:100%;
      border-radius: var(--radius);
      background: var(--panel);
      overflow:hidden;
      border:1px solid rgba(0,0,0,.08);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
      backdrop-filter: blur(6px);
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px;
      border-bottom:1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.92);
      flex:0 0 auto;
    }
    .title{display:flex;flex-direction:column;gap:3px;min-width:240px}
    .title h1{margin:0;font-size:clamp(20px,2.6vw,32px);letter-spacing:-.02em;line-height:1.05}
    .title p{margin:0;color:var(--muted);font-weight:900;font-size:13px}

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:flex-end;
      align-items:center;
    }
    .pill{
      background:#fff;border:1px solid rgba(0,0,0,.10);border-radius:999px;
      padding:10px 12px;font-weight:900;font-size:13px;
      box-shadow: 0 10px 18px rgba(0,0,0,.08);
      white-space:nowrap;
    }
    .btn{
      appearance:none;border:1px solid rgba(0,0,0,.10);
      background:#111827;color:#fff;padding:10px 12px;border-radius:999px;
      font-weight:900;font-size:13px;cursor:pointer;
      box-shadow: 0 16px 28px rgba(17,24,39,.22);
      white-space:nowrap;
    }
    .btn.secondary{background:#fff;color:var(--ink);box-shadow:0 10px 18px rgba(0,0,0,.08)}
    .btn:active{transform:translateY(1px)}

    .main{
      padding:14px;
      display:grid;
      grid-template-columns: 0.85fr 1.15fr;
      gap:14px;
      height: calc(100% - 68px);
      min-height:0;
    }

    .panel{
      border-radius:18px;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      box-shadow: var(--shadow2);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .panelHeader{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 12px;border-bottom:1px solid rgba(0,0,0,.06);
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.90));
      flex:0 0 auto;
    }
    .hint{font-weight:900;font-size:13px;color:#374151}
    .badge{
      font-weight:900;font-size:12px;color:#111827;background:#f3f4f6;
      border:1px solid rgba(0,0,0,.08);padding:8px 10px;border-radius:999px;white-space:nowrap;
    }

    /* chooser */
    .gallery{
      padding:12px;
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
      overflow:auto;
      flex:1 1 auto;
    }
    .thumb{
      border-radius:16px;
      border:1px solid rgba(0,0,0,.10);
      background:#fff;
      box-shadow: 0 12px 22px rgba(0,0,0,.10);
      cursor:pointer;
      overflow:hidden;
      position:relative;
    }
    .thumb img{width:100%;height:170px;object-fit:cover;display:block}
    .thumb span{
      position:absolute;left:10px;right:10px;bottom:10px;
      background: rgba(17,24,39,.86);
      color:#fff;padding:8px 10px;border-radius:12px;
      font-weight:1000;font-size:12px;text-align:center;
    }

    /* puzzle board */
    .boardWrap{
      padding:12px;
      flex:1 1 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(900px 420px at 10% 10%, rgba(255,92,162,.06), transparent 60%),
        radial-gradient(900px 420px at 90% 10%, rgba(88,227,255,.07), transparent 55%),
        radial-gradient(900px 520px at 50% 100%, rgba(98,245,166,.06), transparent 58%);
    }
    .board{
      width:min(640px, 100%);
      aspect-ratio: 1 / 1;
      border-radius:18px;
      border:1px solid rgba(0,0,0,.10);
      background:#fff;
      box-shadow: 0 20px 40px rgba(0,0,0,.12);
      display:grid;
      gap:8px;
      padding:10px;
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
    }

    .tile{
      border-radius:14px;
      border:1px solid rgba(0,0,0,.10);
      background:#f9fafb;
      box-shadow: 0 10px 18px rgba(0,0,0,.10);
      overflow:hidden;
      cursor:grab;
      position:relative;
    }
    .tile:active{cursor:grabbing}
    .tile img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      pointer-events:none;
    }
    .empty{
      background: repeating-linear-gradient(
        45deg,
        rgba(17,24,39,.06),
        rgba(17,24,39,.06) 10px,
        rgba(17,24,39,.03) 10px,
        rgba(17,24,39,.03) 20px
      );
      border-style:dashed;
      box-shadow:none;
      cursor:default;
    }

    .footerNote{
      padding:0 12px 12px;
      color:var(--muted);
      font-weight:800;
      font-size:12px;
      text-align:center;
    }

    @media (max-width: 900px){
      body{overflow:auto}
      .main{grid-template-columns:1fr;height:auto}
      .frame{height:auto}
      .thumb img{height:150px}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="frame">
      <div class="card">
        <div class="top">
          <div class="title">
            <h1>Picture Puzzle Play</h1>
            <p>Choose a picture â†’ drag pieces â†’ complete the puzzle ðŸ§©</p>
          </div>

          <div class="controls">
            <div class="pill" id="modePill">Mode: 2Ã—2</div>
            <div class="pill" id="movesPill">Moves: 0</div>
            <button class="btn secondary" id="toggleBtn">Toggle 2Ã—2 / 3Ã—3</button>
            <button class="btn secondary" id="shuffleBtn">Shuffle</button>
            <button class="btn" id="newBtn">Choose New Picture</button>
          </div>
        </div>

        <div class="main">
          <div class="panel">
            <div class="panelHeader">
              <div class="hint">Choose a picture</div>
              <div class="badge" id="pickBadge">Pick one</div>
            </div>
            <div class="gallery" id="gallery"></div>
            <div class="footerNote">Tip: Start with 2Ã—2 for little learners.</div>
          </div>

          <div class="panel">
            <div class="panelHeader">
              <div class="hint" id="boardHint">Puzzle board</div>
              <div class="badge" id="statusBadge">Ready</div>
            </div>
            <div class="boardWrap">
              <div class="board" id="board" aria-label="Puzzle board"></div>
            </div>
            <div class="footerNote" id="doneNote">Choose a picture on the left to begin.</div>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
(() => {
  // âœ… YOUR 3 FILES (must be in same folder as this HTML)
  const IMAGES = [
    { name: "Star Puzzle",    file: "star.png" },
    { name: "Balloon Puzzle", file: "balloon.png" },
    { name: "Salam Puzzle",   file: "salam.png" },
  ];

  const gallery = document.getElementById("gallery");
  const board = document.getElementById("board");
  const pickBadge = document.getElementById("pickBadge");
  const statusBadge = document.getElementById("statusBadge");
  const modePill = document.getElementById("modePill");
  const movesPill = document.getElementById("movesPill");
  const boardHint = document.getElementById("boardHint");
  const doneNote = document.getElementById("doneNote");

  const toggleBtn = document.getElementById("toggleBtn");
  const shuffleBtn = document.getElementById("shuffleBtn");
  const newBtn = document.getElementById("newBtn");

  let size = 2;      // 2 or 3
  let moves = 0;
  let selected = null;
  let pieces = [];
  let tapped = null;

  // gentle sound
  let audioCtx = null;
  function ensureAudio(){
    if(audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  function blip(freq=740, dur=0.06, vol=0.05){
    try{
      ensureAudio();
      const t = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type="sine";
      o.frequency.setValueAtTime(freq, t);
      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(vol, t+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t+dur);
      o.connect(g); g.connect(audioCtx.destination);
      o.start(t); o.stop(t+dur+0.02);
    }catch(e){}
  }

  function setModePill(){
    modePill.textContent = `Mode: ${size}Ã—${size}`;
    board.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
    board.style.gridTemplateRows = `repeat(${size}, 1fr)`;
  }
  function setMoves(v){
    moves = v;
    movesPill.textContent = `Moves: ${moves}`;
  }

  function renderGallery(){
    gallery.innerHTML = "";
    IMAGES.forEach(img => {
      const btn = document.createElement("div");
      btn.className = "thumb";
      btn.innerHTML = `<img src="${img.file}" alt="${img.name}"><span>${img.name}</span>`;
      btn.addEventListener("click", () => {
        selected = img;
        pickBadge.textContent = "Selected";
        startPuzzle();
      });
      gallery.appendChild(btn);
    });
  }

  function cropStyle(index){
    const row = Math.floor(index / size);
    const col = index % size;
    const step = 100 / (size - 1);
    const x = col * step;
    const y = row * step;
    return `object-position:${x}% ${y}%; object-fit:cover;`;
  }

  function shuffleArray(arr){
    const a = arr.slice();
    for(let i=a.length-1; i>0; i--){
      const j = Math.floor(Math.random() * (i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function buildPieces(){
    const total = size * size;
    const realTiles = total - 1;

    pieces = [];
    for(let i=0; i<realTiles; i++){
      pieces.push({ id:i, correctIndex:i, isEmpty:false });
    }
    pieces.push({ id:"empty", correctIndex: total-1, isEmpty:true });

    pieces = shuffleArray(pieces);
    tapped = null;
    setMoves(0);
  }

  function renderBoard(){
    board.innerHTML = "";
    const total = size * size;

    for(let pos=0; pos<total; pos++){
      const tile = pieces[pos];
      const el = document.createElement("div");
      el.className = "tile";
      el.draggable = !tile.isEmpty;

      if(tile.isEmpty){
        el.classList.add("empty");
      }else{
        const img = document.createElement("img");
        img.src = selected.file;
        img.alt = selected.name;
        img.style = cropStyle(tile.correctIndex);
        el.appendChild(img);
      }

      // drag/drop
      el.addEventListener("dragstart", (e) => {
        if(tile.isEmpty) return;
        e.dataTransfer.setData("text/plain", String(pos));
      });
      el.addEventListener("dragover", (e) => e.preventDefault());
      el.addEventListener("drop", (e) => {
        e.preventDefault();
        const from = Number(e.dataTransfer.getData("text/plain"));
        const to = pos;
        if(Number.isNaN(from)) return;
        swap(from, to);
      });

      // tap swap (tablet-friendly)
      el.addEventListener("click", () => handleTap(pos));

      board.appendChild(el);
    }

    if(isSolved()){
      statusBadge.textContent = "Finished!";
      doneNote.textContent = "âœ¨ Well done! Shuffle or choose a new picture.";
      blip(880,0.08,0.06); setTimeout(()=>blip(1320,0.08,0.05),120);
    }else{
      statusBadge.textContent = "Playing";
      doneNote.textContent = "Drag pieces into the correct places.";
    }
  }

  function handleTap(pos){
    if(!selected) return;
    if(pieces[pos].isEmpty) return;

    if(tapped === null){
      tapped = pos;
      boardHint.textContent = "Tap another piece to swap";
      return;
    }
    if(tapped === pos){
      tapped = null;
      boardHint.textContent = "Puzzle board";
      return;
    }
    swap(tapped, pos);
    tapped = null;
    boardHint.textContent = "Puzzle board";
  }

  function swap(a,b){
    if(!selected) return;
    [pieces[a], pieces[b]] = [pieces[b], pieces[a]];
    setMoves(moves + 1);
    blip(640,0.05,0.05);
    renderBoard();
  }

  function isSolved(){
    const total = size * size;
    for(let pos=0; pos<total; pos++){
      const tile = pieces[pos];
      if(tile.isEmpty){
        if(pos !== total-1) return false;
      }else{
        if(tile.correctIndex !== pos) return false;
      }
    }
    return true;
  }

  function startPuzzle(){
    if(!selected) return;
    boardHint.textContent = "Puzzle board";
    statusBadge.textContent = "Ready";
    buildPieces();
    setModePill();
    renderBoard();
  }

  toggleBtn.addEventListener("click", () => {
    size = (size === 2) ? 3 : 2;
    setModePill();
    if(selected) startPuzzle();
  });

  shuffleBtn.addEventListener("click", () => {
    if(!selected) return;
    buildPieces();
    renderBoard();
  });

  newBtn.addEventListener("click", () => {
    selected = null;
    pickBadge.textContent = "Pick one";
    statusBadge.textContent = "Ready";
    board.innerHTML = "";
    doneNote.textContent = "Choose a picture on the left to begin.";
  });

  // Init
  setModePill();
  setMoves(0);
  renderGallery();
})();
</script>
</body>
</html>

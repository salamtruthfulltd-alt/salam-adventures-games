<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Salam Adventures: Picture Puzzle Play</title>
  <style>
    :root{
      --bg1:#fff1f7;
      --bg2:#eefcff;
      --ink:#101828;
      --muted:#667085;
      --radius:26px;
      --shadow: 0 26px 70px rgba(16,24,40,.16);
      --shadow2: 0 12px 26px rgba(16,24,40,.12);
      --ok:#12b76a;
      --gap:10px;
      --tileR:16px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 650px at 12% 20%, rgba(255,92,210,.20), transparent 55%),
        radial-gradient(850px 650px at 86% 28%, rgba(0,209,255,.16), transparent 55%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
    }

    /* Static 3D frame (NO flashing / NO animation) */
    .frame{
      width:min(980px, 100%);
      border-radius: calc(var(--radius) + 10px);
      padding:12px;
      position:relative;
      filter: drop-shadow(var(--shadow));
      isolation:isolate;
    }
    .frame::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius: calc(var(--radius) + 10px);
      background:
        linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.55)),
        linear-gradient(135deg, rgba(255,92,210,.14), rgba(0,209,255,.12));
      box-shadow:
        inset 0 3px 0 rgba(255,255,255,.85),
        inset 0 -10px 18px rgba(16,24,40,.10),
        0 18px 45px rgba(16,24,40,.14);
      z-index:-2;
    }
    .frame::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius: calc(var(--radius) + 10px);
      padding:4px;
      background: conic-gradient(
        from 0deg,
        #ff4fd8, #7c4dff, #00d1ff, #00ff95, #ffe66d, #ff9b4a, #ff4fd8
      );
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity:.22; /* static glow */
      pointer-events:none;
      z-index:-1;
    }

    .card{
      background: rgba(255,255,255,.90);
      border:1px solid rgba(16,24,40,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      overflow:hidden;
      backdrop-filter: blur(8px);
    }

    header{
      padding:14px 14px 8px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    h1{
      margin:0;
      font-size: clamp(20px, 2.2vw, 30px);
      line-height:1.1;
      letter-spacing:-.02em;
    }
    .sub{
      margin:6px 0 0;
      color:var(--muted);
      font-size: 13px;
      max-width: 60ch;
      font-weight:700;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border:0;
      border-radius: 999px;
      padding:9px 12px;
      background:#101828;
      color:#fff;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(16,24,40,.14);
      font-size:13px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.secondary{
      background:#ffffff;
      color:var(--ink);
      border:1px solid rgba(16,24,40,.12);
      box-shadow: 0 10px 20px rgba(16,24,40,.10);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background:#fff;
      border:1px solid rgba(16,24,40,.10);
      box-shadow: 0 8px 14px rgba(16,24,40,.08);
      color:var(--ink);
      font-weight:900;
      font-size:13px;
      min-width: 132px;
      justify-content:center;
    }

    .content{
      padding: 10px 14px 14px;
      display:grid;
      gap: 14px;
      justify-items:center;
    }

    /* chooser */
    .chooser{
      width:min(920px, 100%);
      display:grid;
      gap:12px;
      grid-template-columns: repeat(3, minmax(0,1fr));
    }
    .thumb{
      border-radius: 18px;
      background: rgba(255,255,255,.92);
      border:1px solid rgba(16,24,40,.12);
      box-shadow: 0 12px 26px rgba(16,24,40,.10);
      padding:10px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .thumb:active{ transform: translateY(1px); }
    .thumb img{
      width:100%;
      height: 150px;
      object-fit: contain;
      display:block;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(255,92,210,.10), rgba(0,209,255,.10));
      border:1px solid rgba(16,24,40,.10);
    }
    .thumb .label{
      margin-top:10px;
      font-weight:900;
      text-align:center;
      font-size:13px;
    }

    /* puzzle area */
    .panel{
      width:min(920px, 100%);
      background: rgba(255,255,255,.92);
      border:1px solid rgba(16,24,40,.10);
      border-radius: 22px;
      box-shadow: 0 16px 40px rgba(16,24,40,.12);
      padding: 12px;
      position:relative;
      overflow:hidden;
      display:none;
    }
    .panel.show{ display:block; }

    .panel::before{
      content:"";
      position:absolute;
      inset:-50% -50%;
      background:
        radial-gradient(circle at 25% 20%, rgba(255,255,255,.85), transparent 40%),
        radial-gradient(circle at 80% 35%, rgba(0,209,255,.10), transparent 45%),
        radial-gradient(circle at 45% 90%, rgba(255,92,210,.08), transparent 45%);
      pointer-events:none;
    }
    .panelInner{ position:relative; }

    .topRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }

    /* Original fit: one big board centered */
    .boardWrap{
      display:grid;
      gap:10px;
      justify-items:center;
    }

    .boardCard{
      width:min(520px, 100%);
      background: rgba(255,255,255,.75);
      border:1px solid rgba(16,24,40,.10);
      border-radius: 20px;
      padding: 12px;
      box-shadow: 0 12px 28px rgba(16,24,40,.10);
    }

    .hint{
      margin:0 0 10px;
      color:var(--muted);
      font-size:12.5px;
      font-weight:700;
      text-align:center;
    }

    .grid{
      width:100%;
      aspect-ratio: 1 / 1;
      display:grid;
      gap: var(--gap);
      user-select:none;
      position:relative;
    }

    /* for 2x3 we don‚Äôt want a square aspect ratio */
    .grid.rect{
      aspect-ratio: 3 / 2; /* wide */
    }

    .tileBtn{
      border-radius: var(--tileR);
      border:1px solid rgba(16,24,40,.10);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.70),
        0 10px 18px rgba(16,24,40,.12);
      background-repeat:no-repeat;
      background-size: var(--bgSizeX) var(--bgSizeY);
      background-position: var(--bgX) var(--bgY);
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      position:relative;
      overflow:hidden;
    }
    .tileBtn::after{
      content:"";
      position:absolute;
      inset:-40% -40%;
      background: radial-gradient(circle at 30% 20%, rgba(255,255,255,.55), transparent 45%);
      pointer-events:none;
    }
    .tileBtn:active{ transform: translateY(1px) scale(.995); }

    .empty{
      background: rgba(255,255,255,.55);
      border: 2px dashed rgba(16,24,40,.18);
      box-shadow:none;
      cursor: default;
    }
    .empty::after{ display:none; }

    .msg{
      text-align:center;
      font-weight:900;
      margin-top: 8px;
      min-height: 20px;
      font-size:14px;
      color:var(--ok);
    }

    @media (max-width: 860px){
      .chooser{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    @media (max-width: 520px){
      header{ padding:12px 12px 8px; }
      .content{ padding: 8px 12px 12px; }
      .chooser{ grid-template-columns: 1fr; }
      .thumb img{ height: 160px; }
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="card">
      <header>
        <div>
          <h1>Picture Puzzle Play</h1>
          <p class="sub">Choose a picture. Tap tiles to slide them into the empty space. Modes: <b>2√ó2</b> and <b>2√ó3</b>. (No flashing.)</p>
        </div>
        <div class="controls">
          <button class="btn secondary" id="backBtn">‚¨ÖÔ∏è Back</button>
          <button class="btn secondary" id="newBtn">üîÄ New puzzle</button>
          <button class="btn" id="modeBtn">üß© <span id="modeLabel">2√ó2</span></button>
          <div class="pill">‚úÖ Solved: <span id="solved">0</span></div>
        </div>
      </header>

      <div class="content">
        <div class="chooser" id="chooser"></div>

        <div class="panel" id="panel">
          <div class="panelInner">
            <div class="topRow">
              <div class="pill">‚≠ê Moves: <span id="moves">0</span></div>
              <div class="pill">üéØ Tap tiles to slide</div>
            </div>

            <div class="boardWrap">
              <div class="boardCard">
                <p class="hint">Tap a tile next to the empty space to move it.</p>
                <div class="grid" id="grid"></div>
                <div class="msg" id="msg"></div>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>

<script>
  // Files must exist in same folder as this HTML:
  // star.png, balloon.png, salam.png
  const IMAGES = [
    { name: "Salam",   file: "salam.png" },
    { name: "Star",    file: "star.png" },
    { name: "Balloon", file: "balloon.png" }
  ];

  const chooser = document.getElementById("chooser");
  const panel = document.getElementById("panel");
  const backBtn = document.getElementById("backBtn");
  const newBtn = document.getElementById("newBtn");
  const modeBtn = document.getElementById("modeBtn");
  const modeLabel = document.getElementById("modeLabel");
  const solvedEl = document.getElementById("solved");
  const movesEl = document.getElementById("moves");
  const gridEl = document.getElementById("grid");
  const msgEl = document.getElementById("msg");

  // modes: 2x2 and 2x3 (exactly as requested)
  const MODES = [
    { r:2, c:2, label:"2√ó2" },
    { r:2, c:3, label:"2√ó3" }
  ];
  let modeIndex = 0;

  let selected = IMAGES[0];
  let solved = 0;
  let moves = 0;

  // board: array of length r*c, contains tileIndex 0..(n-2) or -1 for empty
  // tileIndex maps to a (row,col) in the source image (cropped)
  let board = [];
  let R = 2, C = 2;

  function setMoves(v){ moves=v; movesEl.textContent=String(moves); }
  function incMove(){ setMoves(moves+1); }

  function shuffle(a){
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  // solvability for sliding puzzles:
  // For odd width: inversions even
  // For even width: (blankRowFromBottom even) xor (inversions even)
  function isSolvable(arr, r, c){
    const n = r*c;
    const flat = arr.filter(x => x !== -1);
    let inv = 0;
    for(let i=0;i<flat.length;i++){
      for(let j=i+1;j<flat.length;j++){
        if(flat[i] > flat[j]) inv++;
      }
    }
    if(c % 2 === 1){
      return inv % 2 === 0;
    }else{
      const blankIndex = arr.indexOf(-1);
      const blankRowFromTop = Math.floor(blankIndex / c);
      const blankRowFromBottom = r - blankRowFromTop;
      const invEven = inv % 2 === 0;
      const blankEven = blankRowFromBottom % 2 === 0;
      return (blankEven && !invEven) || (!blankEven && invEven);
    }
  }

  function newBoard(){
    const n = R*C;
    const arr = Array.from({length:n-1}, (_,i)=>i).concat([-1]);

    // shuffle until solvable and not already solved
    let candidate;
    do{
      candidate = shuffle(arr.slice());
    }while(!isSolvable(candidate, R, C) || isSolved(candidate));
    board = candidate;
  }

  function isSolved(arr){
    for(let i=0;i<arr.length-1;i++){
      if(arr[i] !== i) return false;
    }
    return arr[arr.length-1] === -1;
  }

  function tileCrop(tileIndex){
    // tileIndex corresponds to its correct position in the grid
    const tr = Math.floor(tileIndex / C);
    const tc = tileIndex % C;

    const bgSizeX = `${C*100}%`;
    const bgSizeY = `${R*100}%`;

    const x = (C === 1) ? 0 : (tc * 100) / (C - 1);
    const y = (R === 1) ? 0 : (tr * 100) / (R - 1);

    return { bgSizeX, bgSizeY, x, y };
  }

  function canMove(idx){
    const empty = board.indexOf(-1);
    const r1 = Math.floor(idx / C), c1 = idx % C;
    const r2 = Math.floor(empty / C), c2 = empty % C;
    return (Math.abs(r1-r2) + Math.abs(c1-c2)) === 1;
  }

  function move(idx){
    if(!canMove(idx)) return;
    const empty = board.indexOf(-1);
    [board[idx], board[empty]] = [board[empty], board[idx]];
    incMove();
    renderGrid();
    if(isSolved(board)){
      solved++;
      solvedEl.textContent = String(solved);
      msgEl.textContent = "‚úÖ Perfect! You finished the puzzle!";
      setTimeout(()=>{ msgEl.textContent=""; newPuzzle(); }, 900);
    }
  }

  function renderGrid(){
    gridEl.innerHTML = "";
    gridEl.style.gridTemplateColumns = `repeat(${C}, 1fr)`;
    gridEl.style.gridTemplateRows = `repeat(${R}, 1fr)`;

    // make 2x3 look like a rectangle
    gridEl.classList.toggle("rect", (R===2 && C===3));

    for(let i=0;i<board.length;i++){
      const v = board[i];

      const btn = document.createElement("div");
      btn.className = "tileBtn";

      if(v === -1){
        btn.classList.add("empty");
      }else{
        const crop = tileCrop(v);
        btn.style.backgroundImage = `url('${selected.file}')`;
        btn.style.setProperty("--bgSizeX", crop.bgSizeX);
        btn.style.setProperty("--bgSizeY", crop.bgSizeY);
        btn.style.setProperty("--bgX", `${crop.x}%`);
        btn.style.setProperty("--bgY", `${crop.y}%`);
        btn.addEventListener("click", ()=> move(i));
      }

      gridEl.appendChild(btn);
    }
  }

  function renderChooser(){
    chooser.innerHTML = "";
    IMAGES.forEach(img=>{
      const t=document.createElement("div");
      t.className="thumb";
      t.innerHTML = `
        <img src="${img.file}" alt="${img.name}">
        <div class="label">Play: ${img.name}</div>
      `;
      t.addEventListener("click", ()=>{
        selected=img;
        startGame();
      });
      chooser.appendChild(t);
    });
  }

  function startGame(){
    chooser.style.display="none";
    panel.classList.add("show");
    msgEl.textContent="";
    newPuzzle();
  }

  function newPuzzle(){
    const m = MODES[modeIndex];
    R = m.r; C = m.c;
    modeLabel.textContent = m.label;
    setMoves(0);
    newBoard();
    renderGrid();
  }

  function backToChooser(){
    panel.classList.remove("show");
    chooser.style.display="grid";
    msgEl.textContent="";
  }

  backBtn.addEventListener("click", backToChooser);
  newBtn.addEventListener("click", newPuzzle);
  modeBtn.addEventListener("click", ()=>{
    modeIndex = (modeIndex + 1) % MODES.length;
    newPuzzle();
  });

  // init
  renderChooser();
  modeLabel.textContent = MODES[modeIndex].label;
</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Salam Adventures – Puzzle</title>

  <style>
    :root { --gap: 10px; --radius: 16px; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#ffffff;
      display:grid;
      place-items:start center;
      padding:24px 16px;
    }

    .wrap{ width:min(820px, 96vw); display:grid; gap:14px; }

    .controls{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    .btnrow{ display:flex; gap:10px; align-items:center; }

    button{
      border:0;
      padding:8px 14px;
      border-radius:999px;
      background:#111;
      color:#fff;
      font-weight:700;
      cursor:pointer;
    }
    button.secondary{
      background:#fff;
      color:#111;
      box-shadow: inset 0 0 0 2px #111;
    }

    .status{ font-size:14px; color:#111; opacity:.85; }

    .board{
      width:100%;
      background:#fff;
      border-radius:18px;
      box-shadow: 0 14px 40px rgba(0,0,0,.12);
      padding: var(--gap);
      box-sizing:border-box;

      display:grid;
      gap: var(--gap);
      user-select:none;
      touch-action:none;

      /* will be overridden by JS per mode */
      aspect-ratio: 3 / 2;
      min-height: 260px;
    }

    .tile{
      border-radius: var(--radius);
      overflow:hidden;
      background:#eef1f8;
      border:1px solid rgba(0,0,0,.08);
      box-shadow: 0 8px 16px rgba(0,0,0,.10);
      cursor: grab;
      width:100%;
      height:100%;
      position:relative;
      transform: translateZ(0);
    }
    .tile:active{ cursor:grabbing; }

    .tile.dragging{
      opacity:.92;
      outline: 3px solid rgba(17,17,17,.18);
      z-index:9999;
    }

    .tile img{
      width:100%;
      height:100%;
      object-fit: cover;   /* never warps */
      display:block;
      pointer-events:none;
      user-drag:none;
      -webkit-user-drag:none;
    }

    .hint{
      font-size:12px;
      opacity:.7;
      margin-top:-6px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="controls">
      <div class="btnrow">
        <button id="mode3x2">3×2</button>
        <button id="mode2x2" class="secondary">2×2</button>
        <button id="shuffle" class="secondary">Shuffle</button>
      </div>
      <div id="status" class="status">Loading…</div>
    </div>

    <div id="board" class="board" aria-label="Puzzle board"></div>
    <div class="hint">If you see broken images, your file paths/names don’t match your repo (GitHub Pages is case-sensitive).</div>
  </div>

  <script>
    (() => {
      const board = document.getElementById("board");
      const statusEl = document.getElementById("status");

      const btn3x2 = document.getElementById("mode3x2");
      const btn2x2 = document.getElementById("mode2x2");
      const btnShuffle = document.getElementById("shuffle");

      // ✅ Builds correct URLs relative to THIS puzzle.html folder
      const BASE = new URL(".", window.location.href);
      const path = (p) => new URL(p, BASE).href;

      // ✅ EDIT THESE FILENAMES/FOLDERS TO MATCH YOUR REPO EXACTLY
      // Example assumes: /salam-adventures-games/images/puzzle/...
      const PIECES_3x2 = [
        path("images/puzzle/3x2_1.jpg"),
        path("images/puzzle/3x2_2.jpg"),
        path("images/puzzle/3x2_3.jpg"),
        path("images/puzzle/3x2_4.jpg"),
        path("images/puzzle/3x2_5.jpg"),
        path("images/puzzle/3x2_6.jpg")
      ];

      const PIECES_2x2 = [
        path("images/puzzle/2x2_1.jpg"),
        path("images/puzzle/2x2_2.jpg"),
        path("images/puzzle/2x2_3.jpg"),
        path("images/puzzle/2x2_4.jpg")
      ];

      let pieces = PIECES_3x2;
      let cols = 3, rows = 2;
      let order = [];
      let draggingIndex = null;

      function setMode(c, r, arr){
        cols = c; rows = r; pieces = arr;

        board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
        board.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
        board.style.aspectRatio = `${cols} / ${rows}`;

        btn3x2.classList.toggle("secondary", !(cols===3 && rows===2));
        btn2x2.classList.toggle("secondary", !(cols===2 && rows===2));

        order = Array.from({ length: pieces.length }, (_, i) => i);
        shuffle();
        render();
      }

      function shuffle(){
        for(let i = order.length - 1; i > 0; i--){
          const j = Math.floor(Math.random() * (i + 1));
          [order[i], order[j]] = [order[j], order[i]];
        }
      }

      function render(){
        board.innerHTML = "";
        let broken = 0;

        for(let i = 0; i < order.length; i++){
          const idx = order[i];

          const tile = document.createElement("div");
          tile.className = "tile";
          tile.draggable = true;

          const img = document.createElement("img");
          img.alt = "Puzzle piece";
          img.src = pieces[idx];

          img.onerror = () => {
            broken++;
            statusEl.textContent = "❌ Images not loading — check folder/filenames (case-sensitive).";
          };

          tile.appendChild(img);

          tile.addEventListener("dragstart", onDragStart);
          tile.addEventListener("dragend", onDragEnd);
          tile.addEventListener("dragover", (e) => e.preventDefault());
          tile.addEventListener("drop", onDrop);

          board.appendChild(tile);
        }

        // if no errors fire quickly, show normal status
        setTimeout(() => {
          if(broken === 0) checkSolved();
        }, 200);
      }

      function checkSolved(){
        const ok = order.every((id, i) => id === i);
        statusEl.textContent = ok ? "✅ Solved!" : "Drag a tile onto another to swap.";
      }

      function onDragStart(e){
        const tile = e.currentTarget;
        draggingIndex = [...board.children].indexOf(tile);

        // lock size so it doesn’t change shape while dragging
        const rect = tile.getBoundingClientRect();
        tile.style.width = rect.width + "px";
        tile.style.height = rect.height + "px";

        tile.classList.add("dragging");
        e.dataTransfer.effectAllowed = "move";
      }

      function onDragEnd(e){
        const tile = e.currentTarget;
        tile.classList.remove("dragging");
        tile.style.width = "";
        tile.style.height = "";
        draggingIndex = null;
      }

      function onDrop(e){
        e.preventDefault();
        if(draggingIndex === null) return;

        const dropIndex = [...board.children].indexOf(e.currentTarget);
        if(dropIndex === draggingIndex) return;

        [order[draggingIndex], order[dropIndex]] = [order[dropIndex], order[draggingIndex]];
        render();
      }

      btn3x2.addEventListener("click", () => setMode(3,2,PIECES_3x2));
      btn2x2.addEventListener("click", () => setMode(2,2,PIECES_2x2));
      btnShuffle.addEventListener("click", () => { shuffle(); render(); });

      // start
      statusEl.textContent = "Drag a tile onto another to swap.";
      setMode(3,2,PIECES_3x2);
    })();
  </script>
</body>
</html>

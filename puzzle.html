<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Spell & Sparkle | Salam Adventures</title>
  <style>
    :root{
      --ink:#111827;
      --muted:#6b7280;
      --panel: rgba(255,255,255,.90);
      --shadow: 0 26px 80px rgba(0,0,0,.16);
      --shadow2: 0 18px 38px rgba(0,0,0,.14);
      --radius: 22px;
      --borderGrad: conic-gradient(from 180deg,#ff5fa2,#ffd54a,#4cc9ff,#63f5a6,#8b7cff,#ff9b3a,#ff5fa2);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      overflow:hidden;
      background:
        radial-gradient(1200px 700px at 10% 10%, #ffffffaa 0, transparent 55%),
        radial-gradient(900px 650px at 90% 10%, #ffffffaa 0, transparent 50%),
        linear-gradient(120deg, #fde7ef, #e6f4ff);
    }
    .wrap{height:100%;display:flex;align-items:center;justify-content:center;padding:16px}

    /* 3D frame + gentle border pulse ONLY */
    .frame{
      width:min(1100px, 100%);
      height:min(740px, 100%);
      border-radius: calc(var(--radius) + 12px);
      padding:10px;
      background: var(--borderGrad);
      box-shadow: var(--shadow);
      position:relative;
      transform: translateZ(0);
      animation: borderPulse 2.6s ease-in-out infinite;
    }
    @keyframes borderPulse{
      0%,100% { filter: brightness(1); }
      50% { filter: brightness(1.20) saturate(1.05); }
    }
    .frame::before{
      content:"";
      position:absolute;
      inset:6px;
      border-radius: calc(var(--radius) + 8px);
      pointer-events:none;
      background:
        radial-gradient(7px 7px at 12% 18%, rgba(255,255,255,.55) 0 55%, transparent 58%),
        radial-gradient(6px 6px at 88% 22%, rgba(255,255,255,.50) 0 55%, transparent 58%),
        radial-gradient(5px 5px at 70% 85%, rgba(255,255,255,.45) 0 55%, transparent 58%),
        radial-gradient(6px 6px at 25% 78%, rgba(255,255,255,.45) 0 55%, transparent 58%);
      mix-blend-mode: screen;
      opacity:.8;
    }

    .card{
      height:100%;
      border-radius: var(--radius);
      background: var(--panel);
      overflow:hidden;
      position:relative;
      border:1px solid rgba(0,0,0,.08);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
      backdrop-filter: blur(6px);
    }

    .top{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px;border-bottom:1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.92);
    }
    .title{display:flex;flex-direction:column;gap:3px;min-width:240px}
    .title h1{margin:0;font-size:clamp(20px,2.6vw,32px);letter-spacing:-.02em;line-height:1.05}
    .title p{margin:0;color:var(--muted);font-weight:900;font-size:13px}

    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;align-items:center}
    .pill{
      background:#fff;border:1px solid rgba(0,0,0,.10);border-radius:999px;
      padding:10px 12px;font-weight:900;font-size:13px;
      box-shadow: 0 10px 18px rgba(0,0,0,.08);white-space:nowrap;
    }
    .btn{
      appearance:none;border:1px solid rgba(0,0,0,.10);
      background:#111827;color:#fff;padding:10px 12px;border-radius:999px;
      font-weight:900;font-size:13px;cursor:pointer;
      box-shadow: 0 16px 28px rgba(17,24,39,.22);white-space:nowrap;
    }
    .btn.secondary{background:#fff;color:var(--ink);box-shadow: 0 10px 18px rgba(0,0,0,.08)}
    .btn:active{transform:translateY(1px)}

    .toggle{
      display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;
      background:#fff;border:1px solid rgba(0,0,0,.10);
      box-shadow: 0 10px 18px rgba(0,0,0,.08);
      font-weight:900;font-size:13px;cursor:pointer;user-select:none;
    }
    .dot{width:10px;height:10px;border-radius:50%;background:#22c55e;box-shadow:0 0 0 4px rgba(34,197,94,.18)}
    .dot.off{background:#9ca3af;box-shadow:0 0 0 4px rgba(156,163,175,.18)}

    .main{
      padding:14px;
      display:grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap:14px;
      height: calc(100% - 68px);
    }

    .panel{
      border-radius:18px;background:#fff;border:1px solid rgba(0,0,0,.08);
      box-shadow: var(--shadow2);
      overflow:hidden;position:relative;display:flex;flex-direction:column;min-height:0;
    }
    .panelHeader{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 12px;border-bottom:1px solid rgba(0,0,0,.06);
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.90));
    }
    .hint{font-weight:900;font-size:13px;color:#374151}
    .badge{
      font-weight:900;font-size:12px;color:#111827;background:#f3f4f6;
      border:1px solid rgba(0,0,0,.08);padding:8px 10px;border-radius:999px;white-space:nowrap;
    }

    .cardArea{
      flex:1;display:flex;align-items:center;justify-content:center;padding:12px;
      background:
        radial-gradient(900px 420px at 10% 10%, rgba(255,92,162,.06), transparent 60%),
        radial-gradient(900px 420px at 90% 10%, rgba(88,227,255,.07), transparent 55%),
        radial-gradient(900px 520px at 50% 100%, rgba(98,245,166,.06), transparent 58%);
    }
    .wordCard{
      width:min(560px, 100%);
      aspect-ratio: 4 / 3;
      border-radius:18px;border:1px solid rgba(0,0,0,.10);
      box-shadow: 0 20px 40px rgba(0,0,0,.12);
      background:#fff;display:flex;align-items:center;justify-content:center;
      overflow:hidden;
    }
    .wordCard svg{width:100%;height:100%;display:block}

    .status{
      position:absolute;left:12px;right:12px;bottom:12px;padding:10px 12px;border-radius:14px;
      font-weight:1000;text-align:center;color:#fff;background: rgba(17,24,39,.92);
      opacity:0;transform: translateY(8px);
      transition: opacity .18s ease, transform .18s ease;pointer-events:none;
    }
    .status.show{opacity:1;transform:translateY(0)}

    .right{display:flex;flex-direction:column;gap:14px;min-height:0}
    .inputBox{padding:14px;display:flex;flex-direction:column;gap:10px}
    .typed{
      font-size: clamp(22px, 3vw, 34px);
      font-weight:1000;letter-spacing:.10em;text-transform:uppercase;
      padding:14px;border-radius:16px;border:2px solid rgba(0,0,0,.10);
      background:#f9fafb;min-height:64px;display:flex;align-items:center;justify-content:center;
      user-select:none;
    }
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .kbd{padding:12px;display:grid;grid-template-columns: repeat(10, 1fr);gap:8px}
    .key{
      border:none;border-radius:14px;background:#fff;border:1px solid rgba(0,0,0,.12);
      box-shadow: 0 10px 18px rgba(0,0,0,.10);
      font-weight:1000;font-size:16px;padding:12px 0;cursor:pointer;user-select:none;
    }
    .key:active{transform:translateY(1px)}
    .key.wide{grid-column: span 2;}
    .key.wider{grid-column: span 3;}
    .small{font-size:12px;color:var(--muted);font-weight:800;text-align:center;padding:0 12px 12px}

    @media (max-width: 900px){
      .main{grid-template-columns:1fr;height:auto}
      .frame{height:auto}
      body{overflow:auto}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="frame">
      <div class="card">
        <div class="top">
          <div class="title">
            <h1>Spell & Sparkle</h1>
            <p>Listen → tap letters → spell the word ✨</p>
          </div>

          <div class="controls">
            <div class="pill" id="scorePill">Score: 0</div>
            <div class="pill" id="wordPill">Word: 1 / 14</div>

            <div class="toggle" id="voiceToggle" role="button" aria-pressed="true" title="Voice on/off">
              <span class="dot" id="voiceDot"></span>
              <span id="voiceText">Voice: On</span>
            </div>

            <button class="btn secondary" id="hearBtn">Hear Word</button>
            <button class="btn secondary" id="nextBtn">Next</button>
            <button class="btn" id="resetBtn">Reset</button>
          </div>
        </div>

        <div class="main">
          <div class="panel">
            <div class="panelHeader">
              <div class="hint" id="hint">Tap “Hear Word” then spell it!</div>
              <div class="badge" id="message">Ready</div>
            </div>

            <div class="cardArea">
              <div class="wordCard" id="wordCard"></div>
              <div class="status" id="status">Nice!</div>
            </div>
          </div>

          <div class="right">
            <div class="panel">
              <div class="panelHeader">
                <div class="hint">Type the word</div>
                <div class="badge" id="lenBadge">0 letters</div>
              </div>

              <div class="inputBox">
                <div class="typed" id="typed"> </div>

                <div class="actions">
                  <button class="btn secondary" id="checkBtn">Check</button>
                  <button class="btn secondary" id="clearBtn">Clear</button>
                  <button class="btn secondary" id="hintBtn">Hint</button>
                </div>
              </div>

              <div class="kbd" id="kbd"></div>
              <div class="small">Tip: Use the on-screen keyboard (great for tablets).</div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
(() => {
  // -----------------------------
  // Data (simple, obvious words)
  // -----------------------------
  const ITEMS = [
    { word:"apple", svg: svgApple },
    { word:"ball",  svg: svgBall  },
    { word:"cat",   svg: svgCat   },
    { word:"dog",   svg: svgDog   },
    { word:"fish",  svg: svgFish  },
    { word:"sun",   svg: svgSun   },
    { word:"moon",  svg: svgMoon  },
    { word:"hat",   svg: svgHat   },
    { word:"car",   svg: svgCar   },
    { word:"cake",  svg: svgCake  },
    { word:"star",  svg: svgStar  },
    { word:"tree",  svg: svgTree  },
    { word:"book",  svg: svgBook  },
    { word:"bus",   svg: svgBus   },
  ];

  // -----------------------------
  // SVG Card wrapper + shapes
  // -----------------------------
  function cardWrap(inner){
    return `
      <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg" aria-label="Picture card">
        <defs>
          <linearGradient id="bg" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#fff5fb"/>
            <stop offset="1" stop-color="#f0fbff"/>
          </linearGradient>
          <filter id="softShadow" x="-30%" y="-30%" width="160%" height="160%">
            <feDropShadow dx="0" dy="18" stdDeviation="18" flood-color="rgba(0,0,0,.18)"/>
          </filter>
        </defs>

        <rect width="800" height="600" fill="url(#bg)"/>
        <circle cx="120" cy="110" r="22" fill="rgba(255,111,177,.20)"/>
        <circle cx="700" cy="120" r="16" fill="rgba(76,201,255,.20)"/>
        <circle cx="680" cy="500" r="24" fill="rgba(99,245,166,.20)"/>
        <circle cx="130" cy="480" r="18" fill="rgba(255,213,74,.20)"/>

        <rect x="110" y="105" width="580" height="410" rx="34" fill="#ffffff" filter="url(#softShadow)"/>
        <rect x="140" y="132" width="520" height="356" rx="26" fill="#ffffff" stroke="rgba(17,24,39,.10)" stroke-width="4"/>

        ${inner}
      </svg>`;
  }
  const OUT = `stroke="#111827" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"`;

  /* VERY recognisable pictures: simple silhouettes */
  function svgApple(){ return cardWrap(`
    <path d="M420 205c-70-65-185-10-200 90c-15 105 70 195 200 215c130-20 215-110 200-215c-15-100-130-155-200-90Z"
      fill="#ff3b5c" ${OUT}/>
    <path d="M430 195c-10-55 20-95 75-122" fill="none" ${OUT}/>
    <path d="M505 78c45 10 80 40 92 82c-40 16-102 20-140-18c7-28 22-46 48-64Z"
      fill="#32d583" ${OUT}/>
    <path d="M300 245c-38 45-40 135-10 185" fill="none" stroke="rgba(255,255,255,.55)" stroke-width="16" stroke-linecap="round"/>
  `);}

  function svgBall(){ return cardWrap(`
    <circle cx="400" cy="320" r="155" fill="#38bdf8" ${OUT}/>
    <path d="M245 320c65-95 245-95 310 0" fill="none" ${OUT}/>
    <path d="M245 320c65 95 245 95 310 0" fill="none" ${OUT}/>
    <path d="M400 165c-55 65-55 245 0 310" fill="none" ${OUT}/>
  `);}

  function svgCat(){ return cardWrap(`
    <circle cx="400" cy="330" r="150" fill="#fbbf24" ${OUT}/>
    <path d="M300 260l-85-110l12 145Z" fill="#fbbf24" ${OUT}/>
    <path d="M500 260l85-110l-12 145Z" fill="#fbbf24" ${OUT}/>
    <path d="M305 265l-50-65l8 85Z" fill="#fb7185" stroke="rgba(17,24,39,.18)" stroke-width="6" stroke-linejoin="round"/>
    <path d="M495 265l50-65l-8 85Z" fill="#fb7185" stroke="rgba(17,24,39,.18)" stroke-width="6" stroke-linejoin="round"/>
    <path d="M250 420c80 70 220 70 300 0" fill="none" ${OUT} opacity=".45"/>
  `);}

  function svgDog(){ return cardWrap(`
    <circle cx="400" cy="330" r="150" fill="#fb923c" ${OUT}/>
    <path d="M285 300c-70-30-110 55-70 130c20 40 85 60 110 35Z" fill="#fb923c" ${OUT}/>
    <path d="M515 300c70-30 110 55 70 130c-20 40-85 60-110 35Z" fill="#fb923c" ${OUT}/>
    <ellipse cx="400" cy="400" rx="105" ry="78" fill="#fde68a" ${OUT}/>
    <circle cx="400" cy="395" r="18" fill="#111827"/>
    <path d="M360 435c25 25 55 25 80 0" fill="none" ${OUT}/>
  `);}

  function svgFish(){ return cardWrap(`
    <ellipse cx="410" cy="330" rx="210" ry="135" fill="#34d399" ${OUT}/>
    <path d="M605 330l130 95l-28-95l28-95Z" fill="#60a5fa" ${OUT}/>
    <circle cx="320" cy="315" r="20" fill="#ffffff" ${OUT}/>
    <circle cx="320" cy="315" r="10" fill="#111827"/>
    <path d="M360 300c-25 30-25 70 0 100" fill="none" ${OUT} opacity=".55"/>
  `);}

  function svgSun(){ return cardWrap(`
    <circle cx="400" cy="300" r="130" fill="#fbbf24" ${OUT}/>
    <path d="M400 110v70M400 420v70M210 300h-70M590 300h70" fill="none" ${OUT}/>
    <path d="M265 165l-48-48M535 435l48 48M535 165l48-48M265 435l-48 48" fill="none" ${OUT}/>
  `);}

  function svgMoon(){ return cardWrap(`
    <path d="M520 175c-95 20-160 110-160 205c0 125 95 220 220 220c75 0 140-35 175-95
             c-30 15-65 23-103 23c-145 0-260-115-260-260c0-35 6-66 18-93Z"
      fill="#818cf8" ${OUT}/>
    <path d="M250 250l18 40l44 6l-32 30l8 44l-38-20l-38 20l8-44l-32-30l44-6Z"
      fill="#fbbf24" ${OUT}/>
    <path d="M590 240l12 26l29 4l-21 20l5 29l-25-13l-25 13l5-29l-21-20l29-4Z"
      fill="#fbbf24" ${OUT}/>
  `);}

  function svgHat(){ return cardWrap(`
    <path d="M300 260c10-110 70-170 120-175c90 10 140 70 140 175v90H300Z"
      fill="#38bdf8" ${OUT}/>
    <path d="M180 360c120 70 320 70 440 0c0 80-115 140-220 140S180 440 180 360Z"
      fill="#fb7185" ${OUT}/>
  `);}

  function svgCar(){ return cardWrap(`
    <path d="M220 380c25-95 95-155 200-155h60c105 0 175 60 200 155h40c25 0 45 20 45 45v45
             c0 25-20 45-45 45H200c-25 0-45-20-45-45v-45c0-25 20-45 45-45Z"
      fill="#fb7185" ${OUT}/>
    <path d="M310 260h180c60 0 115 35 140 105H235c25-70 80-105 75-105Z"
      fill="#fbbf24" ${OUT}/>
    <circle cx="295" cy="485" r="44" fill="#111827"/>
    <circle cx="605" cy="485" r="44" fill="#111827"/>
    <circle cx="295" cy="485" r="18" fill="#e5e7eb"/>
    <circle cx="605" cy="485" r="18" fill="#e5e7eb"/>
  `);}

  function svgCake(){ return cardWrap(`
    <rect x="250" y="420" width="300" height="120" rx="22" fill="#60a5fa" ${OUT}/>
    <path d="M250 330c45-50 95-50 150 0c55-55 105-55 160 0c55-55 105-55 160 0v110H250Z"
      fill="#fbbf24" ${OUT}/>
    <circle cx="320" cy="385" r="10" fill="#fb7185"/>
    <circle cx="400" cy="385" r="10" fill="#34d399"/>
    <circle cx="480" cy="385" r="10" fill="#818cf8"/>
    <rect x="388" y="235" width="24" height="70" rx="10" fill="#ffffff" ${OUT}/>
    <path d="M400 205c-24 25-24 55 0 80c24-25 24-55 0-80Z" fill="#fb923c" ${OUT}/>
  `);}

  function svgStar(){ return cardWrap(`
    <path d="M400 155l70 145l160 25l-115 110l27 160l-142-75l-142 75l27-160l-115-110l160-25Z"
      fill="#fbbf24" ${OUT}/>
  `);}

  function svgTree(){ return cardWrap(`
    <circle cx="400" cy="285" r="170" fill="#34d399" ${OUT}/>
    <circle cx="300" cy="310" r="90" fill="#22c55e" ${OUT}/>
    <circle cx="515" cy="315" r="95" fill="#22c55e" ${OUT}/>
    <rect x="365" y="350" width="70" height="200" rx="18" fill="#8b5e3c" ${OUT}/>
  `);}

  function svgBook(){ return cardWrap(`
    <path d="M250 220c85-35 170-35 255 0v320c-85-35-170-35-255 0Z" fill="#fb7185" ${OUT}/>
    <path d="M505 220c85-35 170-35 255 0v320c-85-35-170-35-255 0Z" fill="#fbbf24" ${OUT}/>
    <path d="M505 220v320" fill="none" ${OUT} opacity=".35"/>
  `);}

  function svgBus(){ return cardWrap(`
    <rect x="220" y="260" width="360" height="220" rx="34" fill="#38bdf8" ${OUT}/>
    <rect x="255" y="295" width="110" height="80" rx="16" fill="#ffffff" stroke="rgba(17,24,39,.12)" stroke-width="6"/>
    <rect x="380" y="295" width="110" height="80" rx="16" fill="#ffffff" stroke="rgba(17,24,39,.12)" stroke-width="6"/>
    <rect x="510" y="295" width="55" height="80" rx="16" fill="#ffffff" stroke="rgba(17,24,39,.12)" stroke-width="6"/>
    <circle cx="295" cy="490" r="42" fill="#111827"/>
    <circle cx="505" cy="490" r="42" fill="#111827"/>
    <circle cx="295" cy="490" r="16" fill="#e5e7eb"/>
    <circle cx="505" cy="490" r="16" fill="#e5e7eb"/>
  `);}

  // -----------------------------
  // UI / state
  // -----------------------------
  const wordCard = document.getElementById("wordCard");
  const typedEl = document.getElementById("typed");
  const lenBadge = document.getElementById("lenBadge");
  const hintEl = document.getElementById("hint");
  const messageEl = document.getElementById("message");
  const statusEl = document.getElementById("status");

  const scorePill = document.getElementById("scorePill");
  const wordPill = document.getElementById("wordPill");

  const hearBtn = document.getElementById("hearBtn");
  const nextBtn = document.getElementById("nextBtn");
  const resetBtn = document.getElementById("resetBtn");

  const checkBtn = document.getElementById("checkBtn");
  const clearBtn = document.getElementById("clearBtn");
  const hintBtn = document.getElementById("hintBtn");

  const kbd = document.getElementById("kbd");

  const voiceToggle = document.getElementById("voiceToggle");
  const voiceDot = document.getElementById("voiceDot");
  const voiceText = document.getElementById("voiceText");

  let index = 0;
  let typed = "";
  let score = 0;

  // -----------------------------
  // Voice: most natural available
  // -----------------------------
  let voiceOn = true;
  let preferredVoice = null;

  function setVoiceUI(){
    voiceDot.classList.toggle("off", !voiceOn);
    voiceText.textContent = voiceOn ? "Voice: On" : "Voice: Off";
    voiceToggle.setAttribute("aria-pressed", String(voiceOn));
  }
  voiceToggle.addEventListener("click", () => { voiceOn = !voiceOn; setVoiceUI(); });

  function chooseVoice(){
    const voices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
    if(!voices.length) return null;

    const scored = voices
      .filter(v => /en/i.test(v.lang))
      .map(v => {
        let s = 0;
        if(/en-GB/i.test(v.lang)) s += 10;
        if(/en-US/i.test(v.lang)) s += 8;
        if(/Google|Microsoft|Natural|Neural|Enhanced/i.test(v.name)) s += 12;
        if(/robot|compact/i.test(v.name)) s -= 10;
        return {v, s};
      })
      .sort((a,b)=>b.s-a.s);

    return scored[0]?.v || voices[0];
  }

  function speak(text){
    if(!voiceOn) return;
    if(!window.speechSynthesis) return;
    preferredVoice = preferredVoice || chooseVoice();
    const u = new SpeechSynthesisUtterance(text);
    if(preferredVoice) u.voice = preferredVoice;
    u.rate = 0.88;
    u.pitch = 0.98;
    u.volume = 1;
    try{ speechSynthesis.cancel(); speechSynthesis.speak(u); }catch(e){}
  }

  if(window.speechSynthesis){
    speechSynthesis.onvoiceschanged = () => { preferredVoice = chooseVoice(); };
  }

  // -----------------------------
  // Gentle sound blips
  // -----------------------------
  let audioCtx = null;
  function ensureAudio(){
    if(audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  function blip(freq=880, dur=0.06, vol=0.05){
    try{
      ensureAudio();
      const t = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type="sine";
      o.frequency.setValueAtTime(freq, t);
      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(vol, t+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t+dur);
      o.connect(g); g.connect(audioCtx.destination);
      o.start(t); o.stop(t+dur+0.02);
    }catch(e){}
  }

  // -----------------------------
  // Keyboard
  // -----------------------------
  const KEYS = "QWERTYUIOPASDFGHJKLZXCVBNM".split("");
  function renderKeyboard(){
    kbd.innerHTML = "";
    KEYS.forEach(letter => {
      const b = document.createElement("button");
      b.className = "key";
      b.textContent = letter;
      b.addEventListener("click", () => addLetter(letter));
      kbd.appendChild(b);
    });

    const back = document.createElement("button");
    back.className = "key wide";
    back.textContent = "⌫";
    back.addEventListener("click", backspace);
    kbd.appendChild(back);

    const clear = document.createElement("button");
    clear.className = "key wider";
    clear.textContent = "CLEAR";
    clear.addEventListener("click", clearTyped);
    kbd.appendChild(clear);

    const enter = document.createElement("button");
    enter.className = "key wide";
    enter.textContent = "CHECK";
    enter.addEventListener("click", checkWord);
    kbd.appendChild(enter);
  }

  function addLetter(ch){
    const target = ITEMS[index].word.toUpperCase();
    if(typed.length >= target.length) return;
    typed += ch;
    blip(520 + Math.random()*120, 0.05, 0.05);
    updateTyped();
  }
  function backspace(){ typed = typed.slice(0, -1); blip(380,0.05,0.05); updateTyped(); }
  function clearTyped(){ typed = ""; updateTyped(); }

  // -----------------------------
  // Game logic
  // -----------------------------
  function renderWord(){
    const item = ITEMS[index];
    wordCard.innerHTML = item.svg();
    wordPill.textContent = `Word: ${index+1} / ${ITEMS.length}`;
    hintEl.textContent = `Tap “Hear Word” then spell it.`;
    messageEl.textContent = "Ready";
    statusEl.classList.remove("show");
    clearTyped();
  }

  function updateTyped(){
    typedEl.textContent = typed || " ";
    lenBadge.textContent = `${typed.length} letters`;
  }

  function showStatus(text){
    statusEl.textContent = text;
    statusEl.classList.add("show");
    setTimeout(()=>statusEl.classList.remove("show"), 700);
  }

  function checkWord(){
    const target = ITEMS[index].word.toUpperCase();
    if(typed === target){
      score++;
      scorePill.textContent = `Score: ${score}`;
      messageEl.textContent = "Correct!";
      showStatus("✅ Correct!");
      blip(880,0.08,0.06);
      setTimeout(()=>blip(1320,0.08,0.05), 120);
      speak("Yes! That's correct!");
      setTimeout(nextWord, 650);
    }else{
      messageEl.textContent = "Try again";
      showStatus("❌ Try again");
      blip(220,0.10,0.05);
      speak("Try again. Listen carefully.");
    }
  }

  function hintWord(){
    const target = ITEMS[index].word.toUpperCase();
    typed = target[0];
    updateTyped();
    messageEl.textContent = "Hint used";
    speak(`It starts with ${target[0]}.`);
  }

  function hearWord(){
    const w = ITEMS[index].word;
    speak(`Ready? Spell the word: ${w}. ${w}.`);
  }

  function nextWord(){ index = (index + 1) % ITEMS.length; renderWord(); }

  function resetAll(){
    index = 0; score = 0;
    scorePill.textContent = "Score: 0";
    renderWord();
    speak("Let's play. Tap Hear Word.");
  }

  // Buttons
  hearBtn.addEventListener("click", hearWord);
  nextBtn.addEventListener("click", nextWord);
  resetBtn.addEventListener("click", resetAll);
  checkBtn.addEventListener("click", checkWord);
  clearBtn.addEventListener("click", clearTyped);
  hintBtn.addEventListener("click", hintWord);

  // Physical keyboard
  window.addEventListener("keydown", (e) => {
    const k = e.key;
    if(/^[a-z]$/i.test(k)) addLetter(k.toUpperCase());
    else if(k === "Backspace") backspace();
    else if(k === "Enter") checkWord();
  });

  // Init
  renderKeyboard();
  setVoiceUI();
  renderWord();
})();
</script>
</body>
</html>

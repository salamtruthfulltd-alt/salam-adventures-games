<div class="wrap">
  <div class="controls">
    <div class="btnrow">
      <button id="mode3x2">3×2</button>
      <button id="mode2x2" class="secondary">2×2</button>
      <button id="shuffle" class="secondary">Shuffle</button>
    </div>
    <div class="status" id="status">Loading puzzle…</div>
  </div>

  <div id="board" class="board" aria-label="Puzzle board"></div>
</div>

<style>
  :root{ --gap:8px; --radius:14px; --shadow: 0 10px 30px rgba(0,0,0,.12); }

  .wrap{ width: min(720px, 92vw); display:grid; gap:14px; }
  .controls{ display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center; }
  .btnrow{ display:flex; gap:10px; flex-wrap:wrap; }
  button{ border:0; padding:10px 14px; border-radius:999px; background:#111; color:#fff; cursor:pointer; font-weight:700; }
  button.secondary{ background:#fff; color:#111; box-shadow: inset 0 0 0 2px #111; }
  .status{ font-size:14px; opacity:.9; }

  .board{
    width:100%;
    aspect-ratio: 3 / 2;
    background:#fff;
    border-radius:18px;
    box-shadow: var(--shadow);
    padding: var(--gap);
    box-sizing:border-box;
    display:grid;
    gap: var(--gap);
    user-select:none;
    touch-action:none;
    border: 2px solid rgba(0,0,0,.08);
    min-height: 240px; /* so it can’t collapse */
  }

  .tile{
    border-radius: var(--radius);
    border: 2px solid rgba(0,0,0,.15);       /* ✅ makes tiles visible */
    background-color: #e9ecf5;               /* ✅ visible even without image */
    box-shadow: 0 6px 14px rgba(0,0,0,.10);
    background-repeat:no-repeat;
    cursor: grab;
    width:100%;
    height:100%;
    overflow:hidden;
    position:relative;
  }

  .tile span{
    position:absolute;
    inset:0;
    display:grid;
    place-items:center;
    font-weight:900;
    font-size: clamp(22px, 4vw, 40px);
    color: rgba(0,0,0,.35);
    text-shadow: 0 1px 0 rgba(255,255,255,.6);
    pointer-events:none;
  }

  .dragging{ opacity:.92; outline: 3px solid rgba(17,17,17,.20); z-index:9999; }
</style>

<script>
(() => {
  // ✅ IMPORTANT: set this to your real image path
  // If your image is in /images/ folder, use "images/puzzle.jpg"
  const IMAGE_URL = "puzzle-image.jpg";

  const board = document.getElementById("board");
  const statusEl = document.getElementById("status");
  const btn3x2 = document.getElementById("mode3x2");
  const btn2x2 = document.getElementById("mode2x2");
  const btnShuffle = document.getElementById("shuffle");

  let cols = 3, rows = 2;
  let order = [];
  let solved = [];
  let draggingIndex = null;
  let imageOk = false;

  function preloadImage(url){
    return new Promise((resolve) => {
      const img = new Image();
      img.onload = () => resolve(true);
      img.onerror = () => resolve(false);
      img.src = url;
    });
  }

  function setMode(c,r){
    cols = c; rows = r;
    board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    board.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
    board.style.aspectRatio = `${cols} / ${rows}`;

    btn3x2.classList.toggle("secondary", !(cols===3 && rows===2));
    btn2x2.classList.toggle("secondary", !(cols===2 && rows===2));

    buildTiles();
    shuffleTiles();
    render();
  }

  function buildTiles(){
    const n = cols * rows;
    solved = Array.from({length:n}, (_,i)=>i);
    order = solved.slice();
    board.innerHTML = "";

    for(let i=0;i<n;i++){
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.draggable = true;
      tile.dataset.id = String(i);

      // visible label so it's never "empty"
      const label = document.createElement("span");
      label.textContent = i + 1;
      tile.appendChild(label);

      if(imageOk){
        const x = i % cols;
        const y = Math.floor(i / cols);
        tile.style.backgroundImage = `url('${IMAGE_URL}')`;
        tile.style.backgroundSize = `${cols * 100}% ${rows * 100}%`;
        tile.style.backgroundPosition = `${(x * 100)/(cols-1 || 1)}% ${(y * 100)/(rows-1 || 1)}%`;
      }else{
        tile.style.backgroundImage = "none";
      }

      tile.addEventListener("dragstart", onDragStart);
      tile.addEventListener("dragend", onDragEnd);
      tile.addEventListener("dragover", e => { e.preventDefault(); });
      tile.addEventListener("drop", onDrop);

      board.appendChild(tile);
    }
  }

  function shuffleTiles(){
    for(let i=order.length-1; i>0; i--){
      const j = Math.floor(Math.random() * (i+1));
      [order[i], order[j]] = [order[j], order[i]];
    }
  }

  function render(){
    const tilesById = new Map();
    [...board.children].forEach(t => tilesById.set(Number(t.dataset.id), t));
    order.forEach(id => board.appendChild(tilesById.get(id)));
    checkSolved();
  }

  function onDragStart(e){
    const tile = e.currentTarget;
    draggingIndex = [...board.children].indexOf(tile);

    // lock size so it doesn't change shape
    const rect = tile.getBoundingClientRect();
    tile.style.width = rect.width + "px";
    tile.style.height = rect.height + "px";

    tile.classList.add("dragging");
    e.dataTransfer.effectAllowed = "move";
  }

  function onDragEnd(e){
    const tile = e.currentTarget;
    tile.classList.remove("dragging");
    tile.style.width = "";
    tile.style.height = "";
    draggingIndex = null;
  }

  function onDrop(e){
    e.preventDefault();
    if(draggingIndex === null) return;
    const dropIndex = [...board.children].indexOf(e.currentTarget);
    if(dropIndex === draggingIndex) return;
    [order[draggingIndex], order[dropIndex]] = [order[dropIndex], order[draggingIndex]];
    render();
  }

  function checkSolved(){
    const ok = order.every((id, idx) => id === solved[idx]);
    statusEl.textContent = ok ? "✅ Solved!" : "Drag tiles to swap.";
  }

  // buttons
  btn3x2.addEventListener("click", () => setMode(3,2));
  btn2x2.addEventListener("click", () => setMode(2,2));
  btnShuffle.addEventListener("click", () => { shuffleTiles(); render(); });

  // init with image check
  preloadImage(IMAGE_URL).then(ok => {
    imageOk = ok;
    statusEl.textContent = ok
      ? "Drag tiles to swap."
      : "Tiles loaded — but your image path is wrong (showing numbered tiles). Fix IMAGE_URL.";
    setMode(3,2);
  });
})();
</script>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Magic Colour Tap</title>
  <style>
    :root { --rainbow: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000); }
    * { box-sizing: border-box; }
    body { 
      margin: 0; padding: 15px; background: #80deea; 
      font-family: 'Arial Rounded MT Bold', sans-serif;
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
    }

    /* THE RAINBOW BOX */
    .game-box {
      width: 100%; max-width: 950px; padding: 12px; border-radius: 40px;
      background: var(--rainbow); background-size: 400%;
      animation: rainbowMove 8s linear infinite; box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }
    @keyframes rainbowMove { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

    .inner-screen { background: white; border-radius: 30px; display: flex; flex-direction: column; overflow: hidden; position: relative; height: 85vh; }

    header { padding: 15px 25px; border-bottom: 4px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
    
    .game-btn {
      padding: 10px 20px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;
      box-shadow: 0 4px 0 #ccc; transition: 0.1s; background: #4CC9FF; color: white;
    }
    .game-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #ccc; }

    /* CANVAS AREA */
    .canvas-view { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative; overflow: hidden; }
    svg { width: 100%; height: 100%; max-width: 800px; }
    
    /* THE ART STYLE */
    .p { fill: white; stroke: #111; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; transition: fill 0.2s; cursor: pointer; }
    .p:hover { filter: brightness(0.9); }
    .detail { fill: none; stroke: #111; stroke-width: 1.2; pointer-events: none; }

    /* PALETTE */
    .palette-tray { padding: 15px; background: #f9f9f9; display: flex; justify-content: center; gap: 10px; border-top: 4px solid #f0f0f0; }
    .swatch { width: 45px; height: 45px; border-radius: 50%; border: 3px solid white; cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.1); }
    .swatch.active { transform: scale(1.2); border-color: #000; }

    /* GALLERY */
    #gallery { position: absolute; inset: 0; background: white; z-index: 100; padding: 25px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; overflow-y: auto; }
    .thumb { border: 3px solid #eee; border-radius: 20px; cursor: pointer; padding: 10px; background: #fff; transition: 0.2s; }
    .thumb:hover { border-color: #ff00c8; transform: scale(1.02); }
    .thumb svg { height: 100px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="game-box">
  <div class="inner-screen">
    <header>
      <h2 style="margin:0">‚ú® Magic Colour Tap</h2>
      <div style="display:flex; gap:10px">
        <button class="game-btn" onclick="toggleMusic()" id="music-btn">üéµ Music: Off</button>
        <button class="game-btn" style="background:#111" onclick="showGallery()">üñºÔ∏è Gallery</button>
      </div>
    </header>

    <div id="gallery" class="hidden"></div>
    <div class="canvas-view" id="canvas"></div>
    <div class="palette-tray" id="palette"></div>
  </div>
</div>

<script>
  const COLORS = ['#FF3D00', '#FFEA00', '#00E676', '#00B0FF', '#D500F9', '#FF4081', '#795548', '#212121', '#FFFFFF'];
  let currentSelection = COLORS[0];
  let audioCtx = null;
  let isMusicPlaying = false;

  const PAGES = [
    { name: "Magical Castle", svg: `
      <path class="p" d="M150 500 h500 v-150 q0-30-30-30 h-440 q-30 0-30 30 z"/>
      <path class="p" d="M200 320 v-100 h80 v100"/> <path class="p" d="M180 220 l60-80 l60 80 z"/>
      <path class="p" d="M520 320 v-100 h80 v100"/> <path class="p" d="M500 220 l60-80 l60 80 z"/>
      <path class="p" d="M350 500 v-80 a50 50 0 0 1 100 0 v 80 z"/>
      <path class="detail" d="M250 350 h300 M250 400 h300 M250 450 h300"/>` 
    },
    { name: "Deep Forest", svg: `
      <path class="p" d="M380 500 q20-200 40 0 h-40 z"/>
      <path class="p" d="M300 350 q100-150 200 0 q-100 50-200 0 z"/>
      <path class="p" d="M320 250 q80-120 160 0 q-80 40-160 0 z"/>
      <path class="p" d="M150 500 a40 30 0 0 1 80 0 z"/> <path class="p" d="M180 500 v30 h20 v-30"/>
      <path class="detail" d="M395 400 v50 M405 380 v60"/>`
    },
    { name: "Seaw Forest", svg: `
      <path class="p" d="M400 150 a80 80 0 1 1-1 0 z"/>
      <path class="p" d="M350 230 l-50 100 h200 l-50-100 z"/>
      <path class="p" d="M300 330 v150 h200 v-150 z"/>
      <path class="p" d="M350 380 h100 v80 h-100 z"/>
      <path class="detail" d="M310 120 l20 20 M470 120 l-20 20"/>`
    },
    { name: "Under Sea Adv", svg: `
      <path class="p" d="M200 300 q150-150 300 0 l80-50 v100 l-80-50 q-150 150-300 0 z"/>
      <circle class="p" cx="430" cy="280" r="10"/>
      <path class="p" d="M600 500 q-20-80 10-150 t20 150 z"/>
      <path class="p" d="M650 500 q-20-60 10-120 t20 120 z"/>
      <path class="detail" d="M250 300 q50-20 100 0 M250 320 q50-20 100 0"/>`
    },
    { name: "Dragon Explore", svg: `
      <path class="p" d="M300 450 q100-200 300-50 v100 h-300 z"/>
      <path class="p" d="M300 450 q-120 0-120-100 t100-80 h20"/>
      <path class="p" d="M350 320 q50-120 150-50 t-50 150"/>
      <circle class="p" cx="220" cy="300" r="8"/>
      <path class="detail" d="M400 420 h100 M410 440 h80"/>`
    },
    { name: "Space Explorer", svg: `
      <path class="p" d="M400 100 q80 150 80 300 h-160 q0-150 80-300"/>
      <path class="p" d="M330 350 l-50 100 h50 z"/> <path class="p" d="M470 350 l50 100 h-50 z"/>
      <circle class="p" cx="400" cy="250" r="30"/>
      <path class="p" d="M600 150 a50 50 0 1 1-1 0 z"/>
      <path class="detail" d="M540 150 h120"/>`
    }
  ];

  function init() {
    const pal = document.getElementById('palette');
    COLORS.forEach(c => {
      const s = document.createElement('div');
      s.className = 'swatch' + (c === currentSelection ? ' active' : '');
      s.style.background = c;
      s.onclick = () => {
        document.querySelectorAll('.swatch').forEach(sw => sw.classList.remove('active'));
        s.classList.add('active');
        currentSelection = c;
        playTone(440, 'triangle');
      };
      pal.appendChild(s);
    });

    const gal = document.getElementById('gallery');
    PAGES.forEach((p, i) => {
      const d = document.createElement('div');
      d.className = 'thumb';
      d.innerHTML = `<svg viewBox="0 0 800 600">${p.svg}</svg><p style="margin:5px 0 0; font-size:12px;">${p.name}</p>`;
      d.onclick = () => loadPage(i);
      gal.appendChild(d);
    });

    loadPage(0);
  }

  function loadPage(i) {
    const canvas = document.getElementById('canvas');
    canvas.innerHTML = `<svg viewBox="0 0 800 600">${PAGES[i].svg}</svg>`;
    document.getElementById('gallery').classList.add('hidden');
    canvas.querySelectorAll('.p').forEach(el => {
      el.onclick = () => {
        el.style.fill = currentSelection;
        playTone(880, 'sine');
      }
    });
  }

  function showGallery() { document.getElementById('gallery').classList.remove('hidden'); }

  // AUDIO ENGINE
  function playTone(freq, type) {
    if(!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type; osc.connect(gain); gain.connect(audioCtx.destination);
    osc.frequency.value = freq;
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
    osc.start(); osc.stop(audioCtx.currentTime + 0.3);
  }

  function toggleMusic() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    isMusicPlaying = !isMusicPlaying;
    document.getElementById('music-btn').innerText = isMusicPlaying ? "üéµ Music: On" : "üéµ Music: Off";
    if (isMusicPlaying) playLoop();
  }

  function playLoop() {
    if (!isMusicPlaying) return;
    playTone(261.6, 'sine'); // Simple rhythmic beat
    setTimeout(() => { if(isMusicPlaying) playTone(329.6, 'sine'); }, 250);
    setTimeout(playLoop, 500);
  }

  init();
</script>
</body>
</html>

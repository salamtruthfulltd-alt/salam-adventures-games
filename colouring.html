<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Magic Colour Tap: Premium Kids Edition</title>
  <style>
    :root {
      --rainbow: linear-gradient(90deg, #ff5f6d, #ffc371, #ffea00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    body { 
      margin: 0; padding: 10px; background: #fdf2f8; 
      font-family: 'Rounded Mplus 1c', 'Comic Sans MS', sans-serif;
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
    }

    /* PREMIUM TOY CONSOLE */
    .toy-shell {
      width: 100%; max-width: 1000px; padding: 8px; border-radius: 55px;
      background: var(--rainbow); background-size: 200% 200%;
      animation: rainbowFlow 12s linear infinite;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15);
    }
    @keyframes rainbowFlow { 0% {background-position:0% 50%} 100% {background-position:200% 50%} }

    .white-screen {
      background: white; border-radius: 48px; display: flex; flex-direction: column;
      height: 88vh; overflow: hidden; position: relative; border: 4px solid #fff;
    }

    header {
      padding: 15px 30px; background: #fff; border-bottom: 2px solid #fce7f3;
      display: flex; justify-content: space-between; align-items: center;
    }
    .game-title { font-size: 24px; font-weight: 900; color: #db2777; letter-spacing: -0.5px; }

    .nav-btn {
      padding: 10px 20px; border: none; border-radius: 20px; font-weight: 800; cursor: pointer;
      transition: 0.2s; background: #fdf2f8; color: #db2777; box-shadow: 0 4px 0 #fbcfe8;
    }
    .nav-btn:active { transform: translateY(3px); box-shadow: 0 1px 0 #fbcfe8; }
    .btn-gal { background: #db2777; color: white; box-shadow: 0 4px 0 #9d174d; }

    /* VIEWPORT & ART */
    .canvas-area { flex: 1; display: flex; align-items: center; justify-content: center; padding: 25px; background: #fff; }
    svg { width: 100%; height: 100%; max-width: 800px; transition: transform 0.3s ease; }
    
    .part { 
      fill: #fff; stroke: #334155; stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; 
      cursor: pointer; transition: fill 0.4s ease;
    }
    .part:hover { stroke: #db2777; stroke-width: 4; }
    .decoration { fill: none; stroke: #94a3b8; stroke-width: 1.5; pointer-events: none; opacity: 0.6; }

    /* TOOLBAR */
    .palette {
      padding: 20px; background: #fff; display: flex; justify-content: center; 
      gap: 12px; border-top: 2px solid #fce7f3; overflow-x: auto;
    }
    .color-pop {
      min-width: 52px; height: 52px; border-radius: 50%; border: 4px solid white;
      cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .color-pop.active { transform: scale(1.3) translateY(-8px); border-color: #334155; }

    /* GALLERY MENU */
    #gal-overlay {
      position: absolute; inset: 0; background: #fff; z-index: 1000;
      padding: 40px; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; overflow-y: auto;
    }
    .art-thumb { background: #fff; border-radius: 35px; padding: 20px; cursor: pointer; border: 3px solid #fce7f3; transition: 0.3s; text-align: center;}
    .art-thumb:hover { border-color: #db2777; transform: scale(1.03); }
    .art-thumb svg { height: 140px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="toy-shell">
  <div class="white-screen">
    <header>
      <div class="game-title">âœ¨ MAGIC TAP</div>
      <div style="display:flex; gap:10px">
        <button class="nav-btn" onclick="toggleMusic()" id="m-btn">ðŸŽµ Music Off</button>
        <button class="nav-btn btn-gal" onclick="openGal()">ðŸŽ¨ 6 NEW SCENES</button>
      </div>
    </header>

    <div id="gal-overlay" class="hidden"></div>
    <div class="canvas-area" id="view"></div>
    <div class="palette" id="pal"></div>
  </div>
</div>

<script>
  const COLORS = ['#FF5F6D', '#FFC371', '#F4D03F', '#48FF00', '#00FFD5', '#00A2FF', '#A855F7', '#EC4899', '#94A3B8', '#FFFFFF'];
  let pen = COLORS[0], aCtx = null, playing = false;

  const SCENES = [
    { name: "Happy Dino", svg: `
      <path class="part" d="M200 500 c0-250 400-250 400 0 v50 h-400 z"/>
      <path class="part" d="M600 550 c150 0 150-200 50-200 h-50 v200"/>
      <path class="part" d="M200 450 c-150 0-150-150-50-200 c50-20 100 0 100 50"/>
      <circle class="part" cx="180" cy="280" r="15"/>
      <path class="part" d="M350 300 l-30-60 l-30 60"/> <path class="part" d="M450 300 l-30-60 l-30 60"/>
      <circle class="part" cx="400" cy="550" r="40"/>
      <path class="decoration" d="M250 500 q100 20 200 0 t200 0"/>
    `},
    { name: "Magic Butterfly", svg: `
      <path class="part" d="M400 200 q80-150 200-50 t-50 200 q150 150 0 200 t-150-150"/>
      <path class="part" d="M400 200 q-80-150-200-50 t50 200 q-150 150 0 200 t150-150"/>
      <path class="part" d="M380 150 q20 350 40 0 v350 h-40 z"/>
      <circle class="part" cx="500" cy="250" r="30"/> <circle class="part" cx="300" cy="250" r="30"/>
      <path class="decoration" d="M380 100 q-20-50-50-20 M420 100 q20-50 50-20"/>
    `},
    { name: "Friendly Octopus", svg: `
      <path class="part" d="M400 100 c-150 0-150 250 0 250 c150 0 150-250 0-250"/>
      <path class="part" d="M300 330 q-100 100 0 150"/> <path class="part" d="M500 330 q100 100 0 150"/>
      <path class="part" d="M400 350 v150"/> <path class="part" d="M200 300 q-100 50 0 100"/>
      <circle class="part" cx="350" cy="220" r="18"/> <circle class="part" cx="450" cy="220" r="18"/>
      <path class="decoration" d="M380 300 q20 20 40 0"/>
    `},
    { name: "Rocket Cat", svg: `
      <path class="part" d="M400 50 c-100 0-100 300-100 450 h200 c0-150 0-450-100-450"/>
      <path class="part" d="M350 200 a50 50 0 1 1 100 0"/>
      <path class="part" d="M300 400 l-80 120 h80 z"/> <path class="part" d="M500 400 l80 120 h-80 z"/>
      <path class="part" d="M360 180 l-20-40 l40 20 z"/> <path class="part" d="M440 180 l20-40 l-40 20 z"/>
      <path class="decoration" d="M400 500 v80 M380 500 v60 M420 500 v60"/>
    `},
    { name: "Space Donut", svg: `
      <circle class="part" cx="400" cy="300" r="180"/>
      <circle class="part" cx="400" cy="300" r="70"/>
      <path class="part" d="M150 300 q250 150 500 0 t-500 0"/>
      <circle class="part" cx="250" cy="200" r="20"/> <circle class="part" cx="550" cy="400" r="15"/>
      <path class="decoration" d="M300 300 l20-20 M450 350 l20 20 M380 200 l10 30"/>
    `},
    { name: "Sunny Flower", svg: `
      <circle class="part" cx="400" cy="300" r="80"/>
      <path class="part" d="M400 220 c-50-150 150-150 100 0"/> <path class="part" d="M400 220 c50-150-150-150-100 0"/>
      <path class="part" d="M480 300 c150-50 150 150 0 100"/> <path class="part" d="M320 300 c-150-50-150 150 0 100"/>
      <path class="part" d="M400 380 c-100 150 200 150 100 0"/> <path class="part" d="M400 380 c100 150-200 150-100 0"/>
      <path class="part" d="M400 380 v200 h-10 v-200 z"/>
      <path class="decoration" d="M380 280 a5 5 0 1 1 10 0 M420 280 a5 5 0 1 1 10 0"/>
    `}
  ];

  function start() {
    const p = document.getElementById('pal');
    COLORS.forEach(c => {
      const s = document.createElement('div');
      s.className = 'color-pop' + (c === pen ? ' active' : '');
      s.style.backgroundColor = c;
      s.onclick = () => {
        document.querySelectorAll('.color-pop').forEach(x => x.classList.remove('active'));
        s.classList.add('active');
        pen = c;
        playTone(600, 'sine', 0.1);
      };
      p.appendChild(s);
    });

    const g = document.getElementById('gal-overlay');
    SCENES.forEach((s, i) => {
      const c = document.createElement('div');
      c.className = 'art-thumb';
      c.innerHTML = `<svg viewBox="0 0 800 600">${s.svg}</svg><p><b>${s.name}</b></p>`;
      c.onclick = () => loadScene(i);
      g.appendChild(c);
    });
    loadScene(0);
  }

  function loadScene(idx) {
    const v = document.getElementById('view');
    v.innerHTML = `<svg viewBox="0 0 800 600">${SCENES[idx].svg}</svg>`;
    document.getElementById('gal-overlay').classList.add('hidden');
    v.querySelectorAll('.part').forEach(p => {
      p.onclick = (e) => {
        e.stopPropagation();
        p.style.fill = pen;
        brushHiss();
      };
    });
  }

  function openGal() { document.getElementById('gal-overlay').classList.remove('hidden'); }

  function getA() {
    if (!aCtx) aCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (aCtx.state === 'suspended') aCtx.resume();
    return aCtx;
  }

  function playTone(f, t, d) {
    const c = getA();
    const o = c.createOscillator();
    const g = c.createGain();
    o.type = t; o.frequency.value = f;
    g.gain.setValueAtTime(0.1, c.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, c.currentTime + d);
    o.connect(g); g.connect(c.destination);
    o.start(); o.stop(c.currentTime + d);
  }

  function brushHiss() {
    const c = getA();
    const bSize = c.sampleRate * 0.15;
    const buf = c.createBuffer(1, bSize, c.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < bSize; i++) d[i] = Math.random() * 2 - 1;
    const s = c.createBufferSource();
    s.buffer = buf;
    const f = c.createBiquadFilter();
    f.type = 'lowpass'; f.frequency.setValueAtTime(1000, c.currentTime);
    f.frequency.exponentialRampToValueAtTime(100, c.currentTime + 0.15);
    const g = c.createGain();
    g.gain.setValueAtTime(0.08, c.currentTime);
    g.gain.linearRampToValueAtTime(0, c.currentTime + 0.15);
    s.connect(f); f.connect(g); g.connect(c.destination);
    s.start();
  }

  function toggleMusic() {
    getA();
    playing = !playing;
    document.getElementById('m-btn').innerText = playing ? "ðŸŽµ Music On" : "ðŸŽµ Music Off";
    if (playing) loop();
  }

  function loop() {
    if (!playing) return;
    const scale = [329.6, 392.0, 440.0, 523.2];
    playTone(scale[Math.floor(Math.random()*scale.length)], 'sine', 1.5);
    setTimeout(loop, 800);
  }

  start();
</script>
</body>
</html>

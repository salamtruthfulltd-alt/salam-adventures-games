<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Magic Colour Tap | Salam Adventures</title>
  <style>
    :root {
      --rainbow: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
    }
    
    * { box-sizing: border-box; }
    body { 
      margin: 0; padding: 20px;
      background: radial-gradient(circle, #e0f7fa 0%, #80deea 100%);
      font-family: 'Arial Rounded MT Bold', 'Helvetica', sans-serif;
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
    }

    /* THE RAINBOW GAME BOX */
    .game-box {
      width: 100%; max-width: 900px;
      padding: 15px; border-radius: 40px;
      background: var(--rainbow);
      background-size: 400%;
      animation: rainbowMove 10s linear infinite;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    @keyframes rainbowMove { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

    .inner-screen {
      background: white; border-radius: 30px;
      display: flex; flex-direction: column; overflow: hidden; position: relative;
    }

    /* HEADER & BUTTONS */
    header {
      padding: 20px; border-bottom: 4px solid #f0f0f0;
      display: flex; justify-content: space-between; align-items: center;
    }
    .game-title { font-size: 28px; color: #333; margin: 0; }
    
    .btn-group { display: flex; gap: 10px; }
    .game-btn {
      padding: 12px 24px; border: none; border-radius: 15px;
      font-weight: bold; cursor: pointer; font-size: 16px;
      box-shadow: 0 4px 0 #ccc; transition: all 0.1s;
    }
    .game-btn:active { transform: translateY(4px); box-shadow: none; }
    .btn-blue { background: #4CC9FF; color: white; box-shadow: 0 4px 0 #3999c2; }
    .btn-black { background: #111; color: white; box-shadow: 0 4px 0 #000; }

    /* DRAWING AREA */
    .canvas-view { height: 500px; display: flex; align-items: center; justify-content: center; padding: 20px; }
    svg { width: 100%; height: 100%; max-width: 700px; }
    .paint { fill: white; stroke: black; stroke-width: 3; cursor: pointer; transition: fill 0.2s; }

    /* PALETTE */
    .palette-tray {
      padding: 20px; background: #f9f9f9; display: flex; justify-content: center; gap: 12px;
      border-top: 4px solid #f0f0f0; flex-wrap: wrap;
    }
    .swatch {
      width: 45px; height: 45px; border-radius: 50%; border: 4px solid white;
      cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .swatch.active { transform: scale(1.2); border-color: black; }

    /* GALLERY OVERLAY */
    #gallery {
      position: absolute; inset: 0; background: white; z-index: 10;
      padding: 20px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;
    }
    .thumb { border: 2px solid #eee; border-radius: 15px; cursor: pointer; padding: 5px; text-align: center; }
    .thumb:hover { border-color: #ff00c8; }
    .thumb svg { height: 120px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="game-box">
  <div class="inner-screen">
    <header>
      <h1 class="game-title">‚ú® Magic Colour Tap</h1>
      <div class="btn-group">
        <button class="game-btn btn-blue" onclick="toggleMusic()">üéµ Music: Off</button>
        <button class="game-btn btn-black" onclick="showGallery()">üñºÔ∏è Gallery</button>
      </div>
    </header>

    <div id="gallery" class="hidden"></div>

    <div class="canvas-view" id="canvas"></div>

    <div class="palette-tray" id="palette"></div>
  </div>
</div>

<script>
  const COLORS = ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#9400D3', '#000000', '#FFFFFF'];
  let currentSelection = COLORS[0];
  let audioCtx = null;
  let isMusicPlaying = false;

  const PAGES = [
    { name: "Magical Castle", svg: `<path class="paint" d="M150 450 h500 v-200 h-500 z"/><path class="paint" d="M150 250 l50-100 l50 100 z"/><path class="paint" d="M550 250 l50-100 l50 100 z"/><path class="paint" d="M350 450 v-100 a50 50 0 0 1 100 0 v 100 z"/>` },
    { name: "Sea Forest", svg: `<path class="paint" d="M200 400 q100-200 400 0 t-400 0"/><circle class="paint" cx="450" cy="350" r="20"/><path class="paint" d="M600 500 q-50-150 0-300 q50 150 0 300"/>` },
    { name: "Dragon Explorer", svg: `<path class="paint" d="M300 400 q100-200 300-50 v100 h-300 z"/><path class="paint" d="M300 400 q-100 0-100-100 q0-50 50-50 h50"/><circle class="paint" cx="250" cy="500" r="30"/>` },
    { name: "Deep Forest", svg: `<path class="paint" d="M100 500 h50 v-200 h-50 z"/><circle class="paint" cx="125" cy="250" r="80"/><path class="paint" d="M400 500 h40 v-150 h-40 z"/><circle class="paint" cx="420" cy="300" r="60"/>` },
    { name: "Seaw Forest", svg: `<path class="paint" d="M100 300 h100 v250 h-100 z"/><path class="paint" d="M50 300 l100-80 l100 80 z"/><circle class="paint" cx="400" cy="150" r="50"/>` },
    { name: "Under Sea Advanture", svg: `<path class="paint" d="M100 400 q150-100 300 0 q150 100 300 0"/><circle class="paint" cx="200" cy="200" r="20"/><circle class="paint" cx="250" cy="150" r="15"/>` }
  ];

  function init() {
    const pal = document.getElementById('palette');
    COLORS.forEach(c => {
      const s = document.createElement('div');
      s.className = 'swatch' + (c === currentSelection ? ' active' : '');
      s.style.background = c;
      s.onclick = () => {
        document.querySelectorAll('.swatch').forEach(sw => sw.classList.remove('active'));
        s.classList.add('active');
        currentSelection = c;
        playTone(440); // Selection sound
      };
      pal.appendChild(s);
    });

    const gal = document.getElementById('gallery');
    PAGES.forEach((p, i) => {
      const d = document.createElement('div');
      d.className = 'thumb';
      d.innerHTML = `<svg viewBox="0 0 800 600">${p.svg}</svg><p>${p.name}</p>`;
      d.onclick = () => loadPage(i);
      gal.appendChild(d);
    });

    loadPage(0);
  }

  function loadPage(i) {
    const canvas = document.getElementById('canvas');
    canvas.innerHTML = `<svg viewBox="0 0 800 600">${PAGES[i].svg}</svg>`;
    document.getElementById('gallery').classList.add('hidden');
    canvas.querySelectorAll('.paint').forEach(el => {
      el.onclick = () => {
        el.style.fill = currentSelection;
        playTone(660); // Paint sound
      }
    });
  }

  function showGallery() { document.getElementById('gallery').classList.remove('hidden'); }

  // --- AUDIO ENGINE ---
  function playTone(freq) {
    if(!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.frequency.value = freq;
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
    osc.start(); osc.stop(audioCtx.currentTime + 0.5);
  }

  function toggleMusic() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    isMusicPlaying = !isMusicPlaying;
    const btn = document.querySelector('.btn-blue');
    btn.innerText = isMusicPlaying ? "üéµ Music: On" : "üéµ Music: Off";
    if (isMusicPlaying) playLoop();
  }

  function playLoop() {
    if (!isMusicPlaying) return;
    const now = audioCtx.currentTime;
    const notes = [261.63, 329.63, 392.00, 523.25]; // C major
    const note = notes[Math.floor(Math.random() * notes.length)];
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'triangle';
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.frequency.setValueAtTime(note, now);
    gain.gain.setValueAtTime(0.05, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
    osc.start(now); osc.stop(now + 0.5);
    setTimeout(playLoop, 500);
  }

  init();
</script>
</body>
</html>

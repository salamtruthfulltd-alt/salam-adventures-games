<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Magic Colour Tap | Salam Adventures</title>
  <style>
    :root {
      --rainbow: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
      --bg: #e0f7fa;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { 
      margin: 0; padding: 15px; background: var(--bg); 
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
    }

    /* THE BRIGHT RAINBOW CONSOLE */
    .toy-box {
      width: 100%; max-width: 1000px; padding: 12px; border-radius: 50px;
      background: var(--rainbow); background-size: 300% 300%;
      animation: rainbowFlow 8s ease infinite;
      box-shadow: 0 20px 50px rgba(0,0,0,0.15);
    }
    @keyframes rainbowFlow { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

    .inner-white {
      background: #ffffff; border-radius: 40px; display: flex; flex-direction: column; 
      height: 85vh; overflow: hidden; position: relative; border: 4px solid rgba(255,255,255,0.5);
    }

    header {
      padding: 15px 25px; background: #fcfcfc; border-bottom: 2px solid #f0f0f0;
      display: flex; justify-content: space-between; align-items: center;
    }
    .logo { font-size: 24px; font-weight: 900; color: #ff00c8; text-transform: uppercase; letter-spacing: 1px; }

    .btn-group { display: flex; gap: 10px; }
    .btn {
      padding: 10px 18px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;
      transition: 0.2s; font-size: 14px; box-shadow: 0 4px 0 #ddd; background: #fff;
    }
    .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #ddd; }
    .btn-magic { background: #ffca28; color: #724b00; box-shadow: 0 4px 0 #c79100; }

    /* HIGH DENSITY CANVAS */
    .viewport { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; background: #fff; }
    svg { width: 100%; height: 100%; max-width: 800px; }

    /* ART PATHS */
    .p { fill: #fff; stroke: #333; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; cursor: pointer; transition: fill 0.3s; }
    .p:hover { filter: brightness(0.95); }
    .det { fill: none; stroke: #333; stroke-width: 1; pointer-events: none; opacity: 0.4; }

    /* PALETTE */
    .tray { padding: 20px; background: #f9f9f9; display: flex; justify-content: center; gap: 10px; border-top: 2px solid #eee; }
    .swatch {
      width: 50px; height: 50px; border-radius: 50%; border: 4px solid white;
      cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.3s;
    }
    .swatch.active { transform: scale(1.25); border-color: #333; }

    /* OVERLAYS */
    #gallery {
      position: absolute; inset: 0; background: rgba(255,255,255,0.98); z-index: 100;
      padding: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px; overflow-y: auto;
    }
    .thumb { border: 3px solid #eee; border-radius: 25px; padding: 15px; cursor: pointer; transition: 0.2s; background: #fff; }
    .thumb:hover { border-color: #ff00c8; transform: translateY(-5px); }
    .thumb svg { height: 140px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="toy-box">
  <div class="inner-white">
    <header>
      <div class="logo">Magic Colour Tap</div>
      <div class="btn-group">
        <button class="btn btn-magic" onclick="magicFill()">‚ú® Magic Fill</button>
        <button class="btn" onclick="toggleMusic()" id="m-btn">üéµ Music Off</button>
        <button class="btn" style="background:#03a9f4; color:white; box-shadow:0 4px 0 #0277bd" onclick="openGal()">üñºÔ∏è Gallery</button>
      </div>
    </header>

    <div id="gallery" class="hidden"></div>
    <div class="viewport" id="canvas"></div>
    <div class="tray" id="palette"></div>
  </div>
</div>

<script>
  const COLORS = ['#FF5252', '#FF4081', '#E040FB', '#7C4DFF', '#536DFE', '#448AFF', '#40C4FF', '#18FFFF', '#64FFDA', '#B2FF59', '#EEFF41', '#FFFF00', '#FFD740', '#FFAB40', '#FF6E40'];
  let activeCol = COLORS[0];
  let aCtx = null;
  let music = false;

  const ART = [
    { name: "Crystal Castle", svg: `
      <path class="p" d="M100 500 h600 v-180 h-600 z"/>
      <path class="p" d="M150 320 v-220 h100 v220 z"/> <path class="p" d="M140 100 l60-80 l60 80 z"/>
      <path class="p" d="M550 320 v-220 h100 v220 z"/> <path class="p" d="M540 100 l60-80 l60 80 z"/>
      <path class="p" d="M340 500 v-140 c0-50 120-50 120 0 v140 z"/>
      <path class="det" d="M100 400 h600 M100 440 h600 M100 480 h600 M150 200 h100 M550 200 h100"/>
      <rect class="p" x="180" y="240" width="40" height="40" rx="4"/> <rect class="p" x="580" y="240" width="40" height="40" rx="4"/>
    `},
    { name: "Sea Dragon", svg: `
      <path class="p" d="M150 450 q150-300 450 0 v100 h-450 z"/>
      <path class="p" d="M150 450 q-180 0-180-150 t150-100 h50"/>
      <path class="p" d="M350 250 q100-200 200 50 t-50 250"/>
      <circle class="p" cx="120" cy="280" r="12"/>
      <path class="det" d="M220 450 q50 30 150 0 t150 0 t150 0 M220 480 q50 30 150 0"/>
      <path class="p" d="M600 500 l30 40 h-60 z"/>
    `},
    { name: "Space Station", svg: `
      <circle class="p" cx="400" cy="300" r="150"/>
      <path class="p" d="M250 300 h300 v40 h-300 z"/>
      <path class="p" d="M400 50 v100"/> <path class="p" d="M400 450 v100"/>
      <circle class="p" cx="400" cy="300" r="80"/>
      <path class="det" d="M300 200 l200 200 M300 400 l200-200"/>
      <circle class="p" cx="150" cy="100" r="30"/>
    `}
  ];

  function setup() {
    const p = document.getElementById('palette');
    COLORS.forEach(c => {
      const s = document.createElement('div');
      s.className = 'swatch' + (c === activeCol ? ' active' : '');
      s.style.background = c;
      s.onclick = () => {
        document.querySelectorAll('.swatch').forEach(x => x.classList.remove('active'));
        s.classList.add('active');
        activeCol = c;
        beep(440);
      };
      p.appendChild(s);
    });

    const g = document.getElementById('gallery');
    ART.forEach((d, i) => {
      const t = document.createElement('div');
      t.className = 'thumb';
      t.innerHTML = `<svg viewBox="0 0 800 600">${d.svg}</svg><p align="center"><b>${d.name}</b></p>`;
      t.onclick = () => load(i);
      g.appendChild(t);
    });
    load(0);
  }

  function load(idx) {
    const v = document.getElementById('canvas');
    v.innerHTML = `<svg viewBox="0 0 800 600">${ART[idx].svg}</svg>`;
    document.getElementById('gallery').classList.add('hidden');
    v.querySelectorAll('.p').forEach(path => {
      path.onclick = (e) => {
        e.stopPropagation();
        path.style.fill = activeCol;
        brushEffect();
      };
    });
  }

  function openGal() { document.getElementById('gallery').classList.remove('hidden'); }

  function magicFill() {
    document.querySelectorAll('.p').forEach(p => {
      p.style.fill = COLORS[Math.floor(Math.random()*COLORS.length)];
    });
    beep(660);
  }

  // --- AUDIO ---
  function getA() {
    if(!aCtx) aCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(aCtx.state==='suspended') aCtx.resume();
    return aCtx;
  }

  function beep(f) {
    const c = getA();
    const o = c.createOscillator();
    const g = c.createGain();
    o.connect(g); g.connect(c.destination);
    o.frequency.value = f;
    g.gain.setValueAtTime(0.1, c.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, c.currentTime + 0.1);
    o.start(); o.stop(c.currentTime + 0.1);
  }

  function brushEffect() {
    const c = getA();
    const b = c.createBuffer(1, c.sampleRate * 0.2, c.sampleRate);
    const d = b.getChannelData(0);
    for(let i=0; i<b.length; i++) d[i] = Math.random() * 2 - 1;
    const s = c.createBufferSource();
    s.buffer = b;
    const f = c.createBiquadFilter();
    f.type = 'lowpass'; f.frequency.value = 500;
    const g = c.createGain();
    g.gain.setValueAtTime(0.08, c.currentTime);
    g.gain.linearRampToValueAtTime(0, c.currentTime + 0.2);
    s.connect(f); f.connect(g); g.connect(c.destination);
    s.start();
  }

  function toggleMusic() {
    getA();
    music = !music;
    document.getElementById('m-btn').innerText = music ? "üéµ Music On" : "üéµ Music Off";
    if(music) loop();
  }

  function loop() {
    if(!music) return;
    const c = getA();
    const n = [261.6, 329.6, 392.0, 523.2][Math.floor(Math.random()*4)];
    const o = c.createOscillator();
    const g = c.createGain();
    o.type = 'sine'; o.frequency.value = n;
    g.gain.setValueAtTime(0.04, c.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, c.currentTime + 1.5);
    o.connect(g); g.connect(c.destination);
    o.start();
    setTimeout(loop, 700);
  }

  setup();
</script>
</body>
</html>

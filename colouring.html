<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Magic Colour Tap Pro | Salam Adventures</title>
  <style>
    :root { --rainbow: conic-gradient(#ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000); }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { 
      margin: 0; padding: 10px; background: #a5f3fc; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
    }

    /* THE RAINBOW CONSOLE */
    .console {
      width: 100%; max-width: 1000px; padding: 15px; border-radius: 50px;
      background: var(--rainbow); background-size: contain;
      box-shadow: 0 30px 60px rgba(0,0,0,0.3); position: relative;
    }

    .screen { 
      background: white; border-radius: 35px; display: flex; flex-direction: column; 
      overflow: hidden; height: 80vh; position: relative; border: 12px solid #222;
    }

    header { 
      padding: 15px 25px; background: #fff; border-bottom: 2px solid #eee;
      display: flex; justify-content: space-between; align-items: center; z-index: 10;
    }
    
    .btn {
      padding: 12px 20px; border: none; border-radius: 15px; font-weight: 800; 
      cursor: pointer; text-transform: uppercase; transition: 0.1s;
    }
    .btn-music { background: #3b82f6; color: white; box-shadow: 0 4px 0 #1d4ed8; }
    .btn-gallery { background: #111; color: white; box-shadow: 0 4px 0 #000; }
    .btn:active { transform: translateY(3px); box-shadow: none; }

    /* ART VIEWPORT */
    .viewport { flex: 1; background: #fff; display: flex; align-items: center; justify-content: center; padding: 10px; }
    svg { width: 100%; height: 100%; max-width: 750px; }
    
    /* Coloring Logic */
    .p { fill: #fff; stroke: #111; stroke-width: 2.2; stroke-linejoin: round; cursor: pointer; transition: fill 0.25s; }
    .p:hover { fill: #f0f0f0; }
    .no-fill { fill: none !important; pointer-events: none; stroke-width: 1.2; }

    /* PALETTE OVERLAY */
    .palette {
      padding: 15px; background: #f8fafc; display: flex; justify-content: center; gap: 12px;
      border-top: 2px solid #eee;
    }
    .swatch {
      width: 50px; height: 50px; border-radius: 50%; border: 4px solid white;
      cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.2s;
    }
    .swatch.active { transform: scale(1.2) translateY(-5px); border-color: #000; }

    /* GALLERY GRID */
    #gallery {
      position: absolute; inset: 0; background: #fff; z-index: 100;
      padding: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px; overflow-y: auto;
    }
    .thumb { 
      border: 4px solid #f1f5f9; border-radius: 20px; padding: 15px; cursor: pointer;
      text-align: center; transition: 0.2s;
    }
    .thumb:hover { border-color: #ff00c8; background: #fffaf0; }
    .thumb svg { height: 140px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="console">
  <div class="screen">
    <header>
      <h2 style="margin:0">Magic Colour Tap</h2>
      <div style="display:flex; gap:10px">
        <button class="btn btn-music" onclick="toggleMusic()" id="m-btn">üéµ Music: Off</button>
        <button class="btn btn-gallery" onclick="showGallery()">üñºÔ∏è Gallery</button>
      </div>
    </header>

    <div id="gallery" class="hidden"></div>
    <div class="viewport" id="canvas"></div>
    <div class="palette" id="palette"></div>
  </div>
</div>

<script>
  const COLORS = ['#ef4444', '#fbbf24', '#22c55e', '#0ea5e9', '#8b5cf6', '#ec4899', '#78350f', '#000000', '#ffffff'];
  let activeColor = COLORS[0];
  let aCtx = null;
  let isLooping = false;

  // HIGH DETAIL ART TEMPLATES
  const PAGES = [
    { 
      name: "Magical Castle", 
      svg: `
        <path class="p" d="M100 500 h600 v-150 q0-30-30-30 h-540 q-30 0-30 30 z"/>
        <path class="p" d="M150 320 v-180 h100 v180 z"/> <path class="p" d="M130 140 l60-100 l60 100 z"/>
        <path class="p" d="M550 320 v-180 h100 v180 z"/> <path class="p" d="M530 140 l60-100 l60 100 z"/>
        <path class="p" d="M350 500 v-120 a50 50 0 0 1 100 0 v 120 z"/>
        <rect class="p" x="380" y="400" width="10" height="10"/> <rect class="p" x="410" y="400" width="10" height="10"/>
        <path class="p" d="M180 200 h40 v40 h-40 z"/> <path class="p" d="M580 200 h40 v40 h-40 z"/>
        <path class="no-fill" d="M100 400 h600 M100 450 h600 M150 250 h100 M550 250 h100"/>
      `
    },
    {
      name: "Deep Forest",
      svg: `
        <path class="p" d="M350 500 c20-300 80-300 100 0 h-100 z"/>
        <path class="p" d="M250 350 q150-250 300 0 t-300 0"/>
        <path class="p" d="M280 250 q120-180 240 0 t-240 0"/>
        <path class="p" d="M150 480 q50-80 100 0 v20 h-100 z"/>
        <circle class="p" cx="350" cy="280" r="15"/> <circle class="p" cx="450" cy="300" r="20"/>
        <path class="no-fill" d="M375 350 v150 M425 350 v150 M175 450 l10 10 M210 440 l10 10"/>
      `
    },
    {
      name: "Under Sea Adv",
      svg: `
        <path class="p" d="M150 300 q150-200 400 0 l100-80 v160 l-100-80 q-250 200-400 0 z"/>
        <circle class="p" cx="480" cy="270" r="15"/> <circle class="p" cx="485" cy="265" r="5" fill="#000"/>
        <path class="p" d="M250 250 q30-40 60 0 t-60 40"/>
        <path class="p" d="M600 500 q-30-150 20-300 t20 300"/>
        <circle class="p" cx="200" cy="150" r="20"/> <circle class="p" cx="250" cy="100" r="10"/>
        <path class="no-fill" d="M200 300 h200 M210 330 h180 M220 360 h150"/>
      `
    },
    {
      name: "Space Explorer",
      svg: `
        <path class="p" d="M400 50 c100 0 120 250 120 400 h-240 c0-150 20-400 120-400 z"/>
        <path class="p" d="M300 350 l-80 120 h80 z"/> <path class="p" d="M500 350 l80 120 h-80 z"/>
        <circle class="p" cx="400" cy="220" r="40"/>
        <circle class="p" cx="650" cy="150" r="60"/> <path class="p" d="M580 150 q70 40 140 0"/>
        <path class="no-fill" d="M400 50 v50 M400 450 v50"/>
      `
    },
    {
      name: "Dragon Den",
      svg: `
        <path class="p" d="M200 450 q150-250 400-50 v100 h-400 z"/>
        <path class="p" d="M200 450 q-150 0-150-120 t130-90 h20"/>
        <path class="p" d="M350 280 q100-180 200-50 t-50 200"/>
        <circle class="p" cx="150" cy="280" r="10"/>
        <path class="no-fill" d="M250 400 q50 20 100 0 t100 0 t100 0"/>
      `
    },
    {
      name: "Seaw Forest",
      svg: `
        <circle class="p" cx="400" cy="150" r="100"/>
        <path class="p" d="M320 230 l-80 150 h320 l-80-150 z"/>
        <path class="p" d="M320 380 v120 h160 v-120 z"/>
        <rect class="p" x="380" y="420" width="40" height="60" rx="5"/>
        <path class="no-fill" d="M350 100 l20 20 M450 100 l-20 20 M320 400 h160 M320 440 h160"/>
      `
    }
  ];

  function setup() {
    const pal = document.getElementById('palette');
    COLORS.forEach(c => {
      const sw = document.createElement('div');
      sw.className = 'swatch' + (c === activeColor ? ' active' : '');
      sw.style.background = c;
      sw.onclick = () => {
        document.querySelectorAll('.swatch').forEach(s => s.classList.remove('active'));
        sw.classList.add('active');
        activeColor = c;
        beep(440);
      };
      pal.appendChild(sw);
    });

    const gal = document.getElementById('gallery');
    PAGES.forEach((p, i) => {
      const d = document.createElement('div');
      d.className = 'thumb';
      d.innerHTML = `<svg viewBox="0 0 800 600">${p.svg}</svg><p><b>${p.name}</b></p>`;
      d.onclick = () => load(i);
      gal.appendChild(d);
    });
    load(0);
  }

  function load(i) {
    const c = document.getElementById('canvas');
    c.innerHTML = `<svg viewBox="0 0 800 600">${PAGES[i].svg}</svg>`;
    document.getElementById('gallery').classList.add('hidden');
    c.querySelectorAll('.p').forEach(el => {
      el.onclick = () => {
        el.style.fill = activeColor;
        brushSound();
      }
    });
  }

  function showGallery() { document.getElementById('gallery').classList.remove('hidden'); }

  // --- AUDIO EFFECTS ---
  function getA() {
    if (!aCtx) aCtx = new (window.AudioContext || window.webkitAudioContext)();
    return aCtx;
  }

  function beep(f) {
    const ctx = getA();
    const osc = ctx.createOscillator();
    const g = ctx.createGain();
    osc.connect(g); g.connect(ctx.destination);
    osc.frequency.value = f;
    g.gain.setValueAtTime(0.1, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
    osc.start(); osc.stop(ctx.currentTime + 0.1);
  }

  function brushSound() {
    const ctx = getA();
    const bufferSize = ctx.sampleRate * 0.2;
    const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
    const src = ctx.createBufferSource();
    src.buffer = buffer;
    const filter = ctx.createBiquadFilter();
    filter.type = 'lowpass';
    filter.frequency.value = 800;
    const g = ctx.createGain();
    g.gain.setValueAtTime(0.05, ctx.currentTime);
    g.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.2);
    src.connect(filter); filter.connect(g); g.connect(ctx.destination);
    src.start();
  }

  function toggleMusic() {
    getA();
    isLooping = !isLooping;
    document.getElementById('m-btn').innerText = isLooping ? "üéµ Music: On" : "üéµ Music: Off";
    if (isLooping) playMusic();
  }

  function playMusic() {
    if (!isLooping) return;
    const ctx = getA();
    const n = [261, 329, 392, 523][Math.floor(Math.random()*4)];
    const osc = ctx.createOscillator();
    const g = ctx.createGain();
    osc.connect(g); g.connect(ctx.destination);
    osc.type = 'triangle';
    osc.frequency.value = n;
    g.gain.setValueAtTime(0.03, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 1);
    osc.start();
    setTimeout(playMusic, 600);
  }

  setup();
</script>
</body>
</html>

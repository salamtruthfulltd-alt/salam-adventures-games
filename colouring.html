<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Magic Colour Tap: Masterpiece Edition</title>
  <style>
    :root {
      --rainbow: linear-gradient(90deg, #ff5f6d, #ffc371, #eeff41, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { 
      margin: 0; padding: 10px; background: #fdf2f8; 
      font-family: 'Segoe UI', Tahoma, sans-serif;
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
      overflow: hidden;
    }

    /* THE RAINBOW GLOW CONSOLE */
    .console {
      width: 100%; max-width: 1100px; padding: 10px; border-radius: 60px;
      background: var(--rainbow); background-size: 200% 200%;
      animation: rainbowFlow 15s linear infinite;
      box-shadow: 0 30px 60px rgba(0,0,0,0.1);
    }
    @keyframes rainbowFlow { 0% {background-position:0% 50%} 100% {background-position:200% 50%} }

    .screen {
      background: white; border-radius: 52px; display: flex; flex-direction: column;
      height: 90vh; overflow: hidden; position: relative;
    }

    header {
      padding: 20px 40px; background: #fff; border-bottom: 2px solid #f8fafc;
      display: flex; justify-content: space-between; align-items: center;
    }
    .logo { font-size: 28px; font-weight: 900; color: #ff00c8; text-shadow: 1px 1px #eee; }

    .btn {
      padding: 12px 25px; border: none; border-radius: 20px; font-weight: 800; cursor: pointer;
      transition: 0.2s; background: #f1f5f9; color: #475569; box-shadow: 0 5px 0 #cbd5e1;
    }
    .btn:active { transform: translateY(3px); box-shadow: 0 1px 0 #cbd5e1; }
    .btn-main { background: #db2777; color: white; box-shadow: 0 5px 0 #9d174d; }

    /* VIEWPORT */
    .viewport { flex: 1; display: flex; align-items: center; justify-content: center; padding: 30px; background: #fff; }
    svg { width: 100%; height: 100%; max-width: 850px; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.05)); }
    
    /* PRO LINEWORK */
    .p { 
      fill: #fff; stroke: #1e293b; stroke-width: 2.8; stroke-linecap: round; stroke-linejoin: round; 
      cursor: pointer; transition: fill 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
    }
    .p:hover { stroke: #ff00c8; stroke-width: 4; }
    .ink { fill: none; stroke: #64748b; stroke-width: 1.5; pointer-events: none; opacity: 0.4; }

    /* PALETTE */
    .palette {
      padding: 25px; background: #fff; display: flex; justify-content: center; 
      gap: 15px; border-top: 2px solid #f1f5f9; overflow-x: auto;
    }
    .color-swatch {
      min-width: 58px; height: 58px; border-radius: 22px; border: 4px solid white;
      cursor: pointer; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .color-swatch.active { transform: scale(1.3) translateY(-15px); border-color: #1e293b; }

    /* GALLERY MENU */
    #gal-overlay {
      position: absolute; inset: 0; background: rgba(255,255,255,0.98); z-index: 1000;
      padding: 50px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; overflow-y: auto;
    }
    .scene-card { background: white; border-radius: 45px; padding: 20px; cursor: pointer; border: 4px solid #f1f5f9; transition: 0.3s; }
    .scene-card:hover { border-color: #ff00c8; transform: scale(1.05); }
    .scene-card svg { height: 160px; pointer-events: none; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="console">
  <div class="screen">
    <header>
      <div class="logo">SALAM ADVENTURES</div>
      <div style="display:flex; gap:12px">
        <button class="btn" onclick="toggleMusic()" id="mu-btn">ðŸŽµ Music: Off</button>
        <button class="btn btn-main" onclick="openGal()">ðŸŽ¨ 6 NEW SCENES</button>
      </div>
    </header>

    <div id="gal-overlay" class="hidden"></div>
    <div class="viewport" id="view"></div>
    <div class="palette" id="pal"></div>
  </div>
</div>

<script>
  const COLORS = ['#FF4B4B', '#FF9F2E', '#FEE12B', '#2ECC71', '#00D2D3', '#54A0FF', '#5F27CD', '#FF9FF3', '#576574', '#FFFFFF'];
  let pen = COLORS[0], aCtx = null, mus = false;

  const ASSETS = [
    { name: "The Space Whale", svg: `
      <path class="p" d="M150 350 c0-150 500-150 500 0 c0 150-500 150-500 0"/>
      <path class="p" d="M600 350 l150-100 v200 z"/>
      <path class="p" d="M300 250 q100-100 200 0"/>
      <circle class="p" cx="250" cy="330" r="20"/>
      <circle class="p" cx="500" cy="150" r="30"/>
      <path class="ink" d="M200 350 h400 M210 380 h380 M230 410 h340"/>
    `},
    { name: "Super Rocket", svg: `
      <path class="p" d="M400 50 c150 0 150 400 150 500 h-300 c0-100 0-500 150-500 z"/>
      <circle class="p" cx="400" cy="220" r="60"/>
      <path class="p" d="M280 450 l-100 120 h100 z"/>
      <path class="p" d="M520 450 l100 120 h-100 z"/>
      <path class="ink" d="M400 50 v100 M350 480 h100 M350 510 h100"/>
    `},
    { name: "Rainbow Dragon", svg: `
      <path class="p" d="M200 480 q250-400 550 0 v100 h-550 z"/>
      <path class="p" d="M200 480 q-200 0-200-150 t180-120 h40"/>
      <path class="p" d="M380 280 q150-250 250 100 t-100 250"/>
      <circle class="p" cx="160" cy="290" r="15"/>
      <path class="p" d="M620 500 l30 40 h-60 z"/> <path class="p" d="M540 500 l30 40 h-60 z"/>
      <path class="ink" d="M250 450 q100 30 200 0 t200 0"/>
    `},
    { name: "Magic Kitty", svg: `
      <circle class="p" cx="400" cy="300" r="180"/>
      <path class="p" d="M280 180 l-50-80 l100 50 z"/>
      <path class="p" d="M520 180 l50-80 l-100 50 z"/>
      <circle class="p" cx="330" cy="280" r="25"/>
      <circle class="p" cx="470" cy="280" r="25"/>
      <path class="p" d="M380 350 q20 30 40 0"/>
      <path class="ink" d="M250 300 h50 M500 300 h50 M400 380 v40"/>
    `},
    { name: "Crystal Castle", svg: `
      <path class="p" d="M150 500 h500 v-220 h-500 z"/>
      <path class="p" d="M180 280 v-180 h100 v180 z"/>
      <path class="p" d="M520 280 v-180 h100 v180 z"/>
      <path class="p" d="M350 500 v-140 q50-60 100 0 v140 z"/>
      <path class="p" d="M160 100 l70-80 l70 80 z"/>
      <path class="p" d="M500 100 l70-80 l70 80 z"/>
      <path class="ink" d="M150 350 h500 M150 420 h500"/>
    `},
    { name: "Giant Flower", svg: `
      <circle class="p" cx="400" cy="300" r="80"/>
      <path class="p" d="M400 220 c100-150 200 50 0 80"/>
      <path class="p" d="M400 220 c-100-150-200 50 0 80"/>
      <path class="p" d="M480 300 c150-100 150 150 0 50"/>
      <path class="p" d="M320 300 c-150-100-150 150 0 50"/>
      <path class="p" d="M400 380 c100 150 200-50 0-80"/>
      <path class="p" d="M400 380 c-100 150-200-50 0-80"/>
      <path class="p" d="M400 380 v200 h-10 v-200 z"/>
    `}
  ];

  function start() {
    const pal = document.getElementById('pal');
    COLORS.forEach(c => {
      const sw = document.createElement('div');
      sw.className = 'color-swatch' + (c === pen ? ' active' : '');
      sw.style.backgroundColor = c;
      sw.onclick = () => {
        document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
        sw.classList.add('active');
        pen = c;
        playNote(400, 'sine', 0.1);
      };
      pal.appendChild(sw);
    });

    const menu = document.getElementById('gal-overlay');
    ASSETS.forEach((a, i) => {
      const card = document.createElement('div');
      card.className = 'scene-card';
      card.innerHTML = `<svg viewBox="0 0 800 600">${a.svg}</svg><p align="center"><b>${a.name}</b></p>`;
      card.onclick = () => loadScene(i);
      menu.appendChild(card);
    });
    loadScene(0);
  }

  function loadScene(idx) {
    const v = document.getElementById('view');
    v.innerHTML = `<svg viewBox="0 0 800 600">${ASSETS[idx].svg}</svg>`;
    document.getElementById('gal-overlay').classList.add('hidden');
    v.querySelectorAll('.p').forEach(p => {
      p.onclick = (e) => {
        e.stopPropagation();
        p.style.fill = pen;
        brushHiss();
      };
    });
  }

  function openGal() { document.getElementById('gal-overlay').classList.remove('hidden'); }

  function getA() {
    if (!aCtx) aCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (aCtx.state === 'suspended') aCtx.resume();
    return aCtx;
  }

  function playNote(f, t, d) {
    const c = getA();
    const o = c.createOscillator();
    const g = c.createGain();
    o.type = t; o.frequency.value = f;
    g.gain.setValueAtTime(0.1, c.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, c.currentTime + d);
    o.connect(g); g.connect(c.destination);
    o.start(); o.stop(c.currentTime + d);
  }

  function brushHiss() {
    const c = getA();
    const bSize = c.sampleRate * 0.15;
    const buf = c.createBuffer(1, bSize, c.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < bSize; i++) d[i] = Math.random() * 2 - 1;
    const s = c.createBufferSource();
    s.buffer = buf;
    const f = c.createBiquadFilter();
    f.type = 'lowpass'; f.frequency.setValueAtTime(1000, c.currentTime);
    f.frequency.exponentialRampToValueAtTime(100, c.currentTime + 0.15);
    const g = c.createGain();
    g.gain.setValueAtTime(0.08, c.currentTime);
    g.gain.linearRampToValueAtTime(0, c.currentTime + 0.15);
    s.connect(f); f.connect(g); g.connect(c.destination);
    s.start();
  }

  function toggleMusic() {
    getA(); mus = !mus;
    document.getElementById('mu-btn').innerText = mus ? "ðŸŽµ Music: On" : "ðŸŽµ Music: Off";
    if (mus) loop();
  }

  function loop() {
    if (!mus) return;
    const c = getA();
    const sc = [261, 329, 392, 440];
    playNote(sc[Math.floor(Math.random()*sc.length)], 'sine', 1.2);
    setTimeout(loop, 700);
  }

  start();
</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Magic Colour Tap: Artisan Edition</title>
  <style>
    :root {
      --rainbow: linear-gradient(90deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    body { 
      margin: 0; padding: 10px; background: #222; 
      font-family: 'Helvetica Neue', sans-serif;
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
      overflow: hidden;
    }

    /* THE PHYSICAL TOY BOX */
    .toy-outer {
      width: 100%; max-width: 1100px; padding: 18px; border-radius: 65px;
      background: var(--rainbow); background-size: 200% 200%;
      animation: rainbowFlow 5s linear infinite;
      box-shadow: 0 0 50px rgba(0,0,0,0.8), inset 0 5px 15px rgba(255,255,255,0.4);
    }
    @keyframes rainbowFlow { 0% {background-position:0% 50%} 100% {background-position:200% 50%} }

    .toy-inner {
      background: #ffffff; border-radius: 50px; overflow: hidden;
      display: flex; flex-direction: column; height: 88vh; border: 18px solid #1a1a1a;
      box-shadow: inset 0 10px 30px rgba(0,0,0,0.5); position: relative;
    }

    /* HEADER */
    header {
      padding: 15px 40px; background: #1a1a1a; color: white;
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 5px solid #333;
    }
    .game-logo { font-weight: 900; font-size: 24px; letter-spacing: 2px; color: #fff; text-shadow: 0 0 10px #ff00c8; }

    .btn {
      padding: 10px 25px; border-radius: 50px; border: none; font-weight: 800;
      cursor: pointer; transition: 0.2s; font-size: 14px; text-transform: uppercase;
    }
    .btn-action { background: #fff; color: #000; box-shadow: 0 4px 0 #999; }
    .btn-action:active { transform: translateY(4px); box-shadow: none; }

    /* CANVAS */
    .viewport { flex: 1; display: flex; align-items: center; justify-content: center; padding: 40px; background: #fff; position: relative; }
    svg { width: 100%; height: 100%; max-width: 850px; }

    /* ART PATH STYLES */
    .paint-zone { 
      fill: #fff; stroke: #000; stroke-width: 2.8; stroke-linecap: round; stroke-linejoin: round; 
      transition: fill 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; 
    }
    .ink-detail { fill: none; stroke: #000; stroke-width: 1.2; pointer-events: none; opacity: 0.6; }
    
    /* ANIMATED LINES */
    .paint-zone:hover { stroke-width: 4; stroke: #ff00c8; }

    /* TOOLBAR */
    .toolbar {
      padding: 25px; background: #1a1a1a; display: flex; justify-content: center; gap: 15px;
      border-top: 5px solid #333; flex-wrap: wrap;
    }
    .color-pill {
      width: 60px; height: 60px; border-radius: 20px; border: 4px solid #333;
      cursor: pointer; transition: 0.3s; box-shadow: 0 8px 15px rgba(0,0,0,0.4);
    }
    .color-pill.active { transform: scale(1.2) translateY(-10px); border-color: #fff; box-shadow: 0 0 20px currentColor; }

    /* OVERLAYS */
    #gallery {
      position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000;
      padding: 50px; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px; overflow-y: auto; color: white;
    }
    .card { background: #222; border-radius: 35px; padding: 25px; cursor: pointer; transition: 0.3s; border: 2px solid #444; }
    .card:hover { border-color: #ff00c8; transform: scale(1.05); }
    .card svg { height: 180px; pointer-events: none; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="toy-outer">
  <div class="toy-inner">
    <header>
      <div class="game-logo">SALAM ADVENTURES</div>
      <div style="display:flex; gap:15px">
        <button class="btn btn-action" onclick="toggleMusic()" id="m-btn">üéµ Music: Off</button>
        <button class="btn btn-action" onclick="showGallery()">üñºÔ∏è Gallery</button>
      </div>
    </header>

    <div id="gallery" class="hidden"></div>
    <div class="viewport" id="canvas"></div>
    <div class="toolbar" id="palette"></div>
  </div>
</div>

<script>
  const COLORS = ['#FF0000', '#FF7B00', '#FFD000', '#00FF6A', '#00A2FF', '#7000FF', '#FF00A2', '#1A1A1A', '#FFFFFF'];
  let currentSelection = COLORS[0];
  let audioCtx = null;
  let musicIsOn = false;

  // HIGH-FIDELITY ASSETS
  const DRAWINGS = [
    { name: "The Crystal Castle", svg: `
      <path class="paint-zone" d="M100 550 h600 v-200 h-600 z"/>
      <path class="paint-zone" d="M120 350 v-250 l80-50 l80 50 v250 z"/>
      <path class="paint-zone" d="M520 350 v-250 l80-50 l80 50 v250 z"/>
      <path class="paint-zone" d="M330 550 v-150 a70 70 0 0 1 140 0 v 150 z"/>
      <path class="ink-detail" d="M120 150 h160 M520 150 h160 M120 250 h160 M100 450 h600 M100 500 h600"/>
      <circle class="paint-zone" cx="200" cy="200" r="30"/> <circle class="paint-zone" cx="600" cy="200" r="30"/>
    `},
    { name: "Enchanted Woods", svg: `
      <path class="paint-zone" d="M380 550 c-50-300 100-300 50 0 z"/>
      <path class="paint-zone" d="M200 400 c0-120 400-120 400 0 q-200 80-400 0 z"/>
      <path class="paint-zone" d="M250 300 c0-100 300-100 300 0 q-150 60-300 0 z"/>
      <path class="paint-zone" d="M300 220 c0-80 200-80 200 0 q-100 40-200 0 z"/>
      <circle class="paint-zone" cx="150" cy="520" r="40"/>
      <path class="ink-detail" d="M400 350 v200 M390 400 v100 M250 380 l50-20 M550 380 l-50-20"/>
    `},
    { name: "The Deep Sea Explorer", svg: `
      <path class="paint-zone" d="M150 350 q150-250 450 0 l150-100 v200 l-150-100 q-300 250-450 0 z"/>
      <path class="paint-zone" d="M250 250 q80-100 150 0"/>
      <circle class="paint-zone" cx="500" cy="320" r="25"/>
      <circle class="paint-zone" cx="505" cy="315" r="8" fill="#000"/>
      <path class="ink-detail" d="M200 350 h300 M210 380 h280 M220 410 h250"/>
      <circle class="paint-zone" cx="100" cy="100" r="30"/> <circle class="paint-zone" cx="200" cy="50" r="15"/>
    `},
    { name: "Cosmic Rocket", svg: `
      <path class="paint-zone" d="M400 50 c150 0 150 350 150 450 h-300 c0-100 0-450 150-450 z"/>
      <path class="paint-zone" d="M300 400 l-100 150 h100 z"/>
      <path class="paint-zone" d="M500 400 l100 150 h-100 z"/>
      <circle class="paint-zone" cx="400" cy="200" r="50"/>
      <path class="ink-detail" d="M400 50 v100 M350 450 h100 M350 480 h100"/>
    `},
    { name: "Sleeping Dragon", svg: `
      <path class="paint-zone" d="M200 500 q200-300 500 0 v80 h-500 z"/>
      <path class="paint-zone" d="M200 500 q-180 0-180-150 t150-100 h50"/>
      <circle class="paint-zone" cx="150" cy="320" r="15"/>
      <path class="paint-zone" d="M400 350 q150-200 250 50 t-100 250"/>
      <path class="ink-detail" d="M250 500 q50 30 150 0 t150 0 t150 0"/>
    `},
    { name: "Solar Temple", svg: `
      <circle class="paint-zone" cx="400" cy="200" r="150"/>
      <path class="paint-zone" d="M200 550 l200-250 l200 250 z"/>
      <path class="ink-detail" d="M400 50 v100 M400 350 v100 M200 200 h100 M500 200 h100"/>
      <path class="paint-zone" d="M350 450 h100 v100 h-100 z"/>
    `}
  ];

  function init() {
    const pal = document.getElementById('palette');
    COLORS.forEach(c => {
      const p = document.createElement('div');
      p.className = 'color-pill' + (c === currentSelection ? ' active' : '');
      p.style.backgroundColor = c;
      p.style.color = c;
      p.onclick = () => {
        document.querySelectorAll('.color-pill').forEach(x => x.classList.remove('active'));
        p.classList.add('active');
        currentSelection = c;
        playTone(300, 'sine', 0.1);
      };
      pal.appendChild(p);
    });

    const gal = document.getElementById('gallery');
    DRAWINGS.forEach((d, i) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `<svg viewBox="0 0 800 600">${d.svg}</svg><h3>${d.name}</h3>`;
      card.onclick = () => loadArt(i);
      gal.appendChild(card);
    });
    loadArt(0);
  }

  function loadArt(idx) {
    const canvas = document.getElementById('canvas');
    canvas.innerHTML = `<svg viewBox="0 0 800 600">${DRAWINGS[idx].svg}</svg>`;
    document.getElementById('gallery').classList.add('hidden');
    canvas.querySelectorAll('.paint-zone').forEach(path => {
      path.onclick = (e) => {
        e.stopPropagation();
        path.style.fill = currentSelection;
        playPaintSound();
      };
    });
  }

  function showGallery() { document.getElementById('gallery').classList.remove('hidden'); }

  // --- AUDIO ENGINE ---
  function getCtx() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === 'suspended') audioCtx.resume();
    return audioCtx;
  }

  function playTone(freq, type, dur) {
    const ctx = getCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.type = type; osc.frequency.value = freq;
    gain.gain.setValueAtTime(0.1, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + dur);
    osc.connect(gain); gain.connect(ctx.destination);
    osc.start(); osc.stop(ctx.currentTime + dur);
  }

  function playPaintSound() {
    const ctx = getCtx();
    const bufferSize = ctx.sampleRate * 0.15;
    const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
    const noise = ctx.createBufferSource();
    noise.buffer = buffer;
    const filter = ctx.createBiquadFilter();
    filter.type = 'lowpass';
    filter.frequency.setValueAtTime(1000, ctx.currentTime);
    filter.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.15);
    const g = ctx.createGain();
    g.gain.setValueAtTime(0.1, ctx.currentTime);
    g.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.15);
    noise.connect(filter); filter.connect(g); g.connect(ctx.destination);
    noise.start();
    playTone(200, 'triangle', 0.2); // Squelch
  }

  function toggleMusic() {
    getCtx();
    musicIsOn = !musicIsOn;
    document.getElementById('m-btn').innerText = musicIsOn ? "üéµ Music: On" : "üéµ Music: Off";
    if (musicIsOn) startLoop();
  }

  function startLoop() {
    if (!musicIsOn) return;
    const scale = [261.6, 329.6, 392.0, 440.0, 523.2];
    playTone(scale[Math.floor(Math.random()*scale.length)], 'sine', 1.0);
    setTimeout(startLoop, 800);
  }

  init();
</script>
</body>
</html>

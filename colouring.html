<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Colouring Generator | Salam Adventures</title>

<style>
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  margin:0;
  background:#f4f4f4;
}
header{
  padding:20px;
  background:#fff;
  border-bottom:1px solid #eee;
}
main{
  padding:20px;
  max-width:1100px;
  margin:auto;
}
.controls{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:15px;
}
button,select{
  padding:10px 14px;
  border-radius:8px;
  border:1px solid #ddd;
  cursor:pointer;
}
button{
  background:#111;
  color:#fff;
}
button.secondary{
  background:#fff;
  color:#111;
}
.canvasWrap{
  background:#fff;
  padding:15px;
  border-radius:14px;
  border:1px solid #ddd;
}
canvas{
  display:block;
  margin:auto;
  background:#fff;
}
</style>
</head>

<body>

<header>
<h2>Colouring Page Generator</h2>
</header>

<main>

<div class="controls">
<select id="picker"></select>
<button id="btnLoad">Load</button>
<button id="btnRandom" class="secondary">Random</button>
<button id="btnDownload" class="secondary">Download</button>
<button id="btnPrint" class="secondary">Print</button>
</div>

<div class="canvasWrap">
<canvas id="c" width="1240" height="1754"></canvas>
</div>

</main>

<script>
const BASE_RAW =
"https://raw.githubusercontent.com/salamtruthfulltd-alt/salam-adventures-games/main/colouring%20images/";

const FILES = [
"butterfly.png",
"car.png",
"chest.png",
"dino.png",
"dog.png",
"doll.png",
"house.png",
"kids.png",
"plane.png",
"prince.png",
"swan.png",
"veg.png"
];

const picker=document.getElementById("picker");
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");

const off=document.createElement("canvas");
const offCtx=off.getContext("2d");

FILES.forEach(f=>{
  const opt=document.createElement("option");
  opt.value=f;
  opt.textContent=f.replace(".png","");
  picker.appendChild(opt);
});
picker.value=FILES[0];

function clearWhite(){
  ctx.fillStyle="#fff";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

function drawBorder(){
  const margin=80;
  ctx.lineWidth=14;
  ctx.strokeStyle="#000";
  ctx.strokeRect(margin,margin,canvas.width-margin*2,canvas.height-margin*2);
}

function findBounds(imageData,w,h){
  const d=imageData.data;
  let top=h, left=w, right=0, bottom=0;

  for(let y=0;y<h;y++){
    for(let x=0;x<w;x++){
      const i=(y*w+x)*4;
      const r=d[i], g=d[i+1], b=d[i+2];
      if(!(r>240 && g>240 && b>240)){
        if(x<left) left=x;
        if(x>right) right=x;
        if(y<top) top=y;
        if(y>bottom) bottom=y;
      }
    }
  }

  return {top,left,right,bottom};
}

async function loadImage(file){
  const img=new Image();
  img.crossOrigin="anonymous";
  img.src=BASE_RAW + encodeURIComponent(file);

  await new Promise((res,rej)=>{
    img.onload=res;
    img.onerror=rej;
  });

  off.width=img.naturalWidth;
  off.height=img.naturalHeight;
  offCtx.clearRect(0,0,off.width,off.height);
  offCtx.drawImage(img,0,0);

  const imageData=offCtx.getImageData(0,0,off.width,off.height);
  const b=findBounds(imageData,off.width,off.height);

  const cropW=b.right-b.left;
  const cropH=b.bottom-b.top;

  clearWhite();
  drawBorder();

  // ðŸ”¥ ALL DRAWINGS FORCED TO SAME VISUAL HEIGHT
  const TARGET_HEIGHT=1200;
  const scale=TARGET_HEIGHT/cropH;

  const drawW=cropW*scale;
  const drawH=cropH*scale;

  const dx=(canvas.width-drawW)/2;
  const dy=(canvas.height-drawH)/2;

  ctx.drawImage(
    off,
    b.left,b.top,cropW,cropH,
    dx,dy,drawW,drawH
  );
}

document.getElementById("btnLoad")
.addEventListener("click",()=>loadImage(picker.value));

document.getElementById("btnRandom")
.addEventListener("click",()=>{
  const r=FILES[Math.floor(Math.random()*FILES.length)];
  picker.value=r;
  loadImage(r);
});

document.getElementById("btnDownload")
.addEventListener("click",()=>{
  const a=document.createElement("a");
  a.download="colouring.png";
  a.href=canvas.toDataURL("image/png");
  a.click();
});

document.getElementById("btnPrint")
.addEventListener("click",()=>{
  const w=window.open("");
  w.document.write(`
    <img src="${canvas.toDataURL("image/png")}" style="width:100%">
    <script>window.onload=()=>window.print()<\/script>
  `);
  w.document.close();
});

loadImage(picker.value);
</script>

</body>
</html>

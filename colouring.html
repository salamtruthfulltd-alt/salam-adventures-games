<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Magic Colour Tap: Pro Edition</title>
  <style>
    :root {
      --rainbow: linear-gradient(90deg, #ff0000, #ffea00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000);
      --soft-bg: #f0f9ff;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    body { 
      margin: 0; padding: 10px; background: var(--soft-bg); 
      font-family: 'Segoe UI', system-ui, sans-serif;
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
    }

    /* THE RAINBOW GLOW FRAME */
    .toy-frame {
      width: 100%; max-width: 1050px; padding: 15px; border-radius: 55px;
      background: var(--rainbow); background-size: 200% 200%;
      animation: rainbowMove 6s linear infinite;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.2);
    }
    @keyframes rainbowMove { 0% {background-position:0% 50%} 100% {background-position:200% 50%} }

    .white-core {
      background: white; border-radius: 45px; display: flex; flex-direction: column;
      height: 88vh; overflow: hidden; position: relative;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
    }

    header {
      padding: 18px 30px; background: #ffffff; border-bottom: 3px solid #f1f5f9;
      display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-size: 28px; font-weight: 900; background: var(--rainbow); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    .btn-ui {
      padding: 12px 24px; border: none; border-radius: 16px; font-weight: 700; cursor: pointer;
      transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      background: #f8fafc; color: #64748b; box-shadow: 0 4px 0 #e2e8f0;
    }
    .btn-ui:active { transform: translateY(3px); box-shadow: 0 1px 0 #e2e8f0; }
    .btn-primary { background: #0ea5e9; color: white; box-shadow: 0 4px 0 #0369a1; }

    /* PRO CANVAS */
    .art-zone { flex: 1; display: flex; align-items: center; justify-content: center; padding: 30px; background: #fff; }
    svg { width: 100%; height: 100%; max-width: 850px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.03)); }
    
    .p { fill: #fff; stroke: #1e293b; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; transition: all 0.4s ease; cursor: pointer; }
    .p:active { transform: scale(1.01); }
    .detail-lines { fill: none; stroke: #94a3b8; stroke-width: 1.2; pointer-events: none; }

    /* COLORS */
    .color-bar {
      padding: 20px 30px; background: #fdfdfd; display: flex; justify-content: center; 
      gap: 12px; border-top: 3px solid #f1f5f9; overflow-x: auto;
    }
    .color-circle {
      min-width: 52px; height: 52px; border-radius: 18px; border: 4px solid white;
      cursor: pointer; transition: 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .color-circle.active { transform: scale(1.2) translateY(-8px); border-color: #1e293b; box-shadow: 0 12px 20px rgba(0,0,0,0.15); }

    /* GALLERY */
    #gal {
      position: absolute; inset: 0; background: rgba(255,255,255,0.98); z-index: 1000;
      padding: 40px; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; overflow-y: auto;
    }
    .art-card { background: white; border-radius: 35px; padding: 20px; cursor: pointer; border: 3px solid #f1f5f9; transition: 0.3s; }
    .art-card:hover { border-color: #0ea5e9; transform: translateY(-8px); }
    .art-card svg { height: 160px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="toy-frame">
  <div class="white-core">
    <header>
      <div class="brand">MAGIC COLOUR TAP</div>
      <div style="display:flex; gap:12px">
        <button class="btn-ui btn-primary" onclick="magicFill()">âœ¨ Magic</button>
        <button class="btn-ui" onclick="toggleMusic()" id="mu-btn">ðŸŽµ Music: Off</button>
        <button class="btn-ui" onclick="showGal()">Gallery</button>
      </div>
    </header>

    <div id="gal" class="hidden"></div>
    <div class="art-zone" id="stage"></div>
    <div class="color-bar" id="palette"></div>
  </div>
</div>

<script>
  const COLORS = ['#ef4444', '#f97316', '#f59e0b', '#10b981', '#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899', '#475569', '#ffffff'];
  let pen = COLORS[0];
  let aCtx = null, musicOn = false;

  const SCENES = [
    { name: "The Grand Castle", svg: `
      <path class="p" d="M100 500 h600 v-200 h-600 z"/>
      <path class="p" d="M150 300 v-200 h100 v200 z"/> <path class="p" d="M130 100 l70-80 l70 80 z"/>
      <path class="p" d="M550 300 v-200 h100 v200 z"/> <path class="p" d="M530 100 l70-80 l70 80 z"/>
      <path class="p" d="M320 500 v-120 c0-60 160-60 160 0 v120 z"/>
      <circle class="p" cx="200" cy="180" r="20"/> <circle class="p" cx="600" cy="180" r="20"/>
      <path class="detail-lines" d="M100 350 h600 M100 400 h600 M100 450 h600 M200 20 v60 M600 20 v60"/>
      <circle class="p" cx="400" cy="400" r="10"/> `},
    { name: "Whimsical Dragon", svg: `
      <path class="p" d="M200 480 q200-350 500 0 v100 h-500 z"/> <path class="p" d="M200 480 q-200 0-200-180 t180-120 h40"/> <path class="p" d="M350 280 q120-220 250 50 t-100 250"/> <circle class="p" cx="160" cy="280" r="15"/> <circle class="p" cx="165" cy="275" r="5" fill="#000"/>
      <path class="p" d="M600 500 l40 60 h-80 z"/> <path class="p" d="M500 500 l40 60 h-80 z"/> <path class="detail-lines" d="M250 450 q100 30 200 0 t200 0"/>
    `},
    { name: "Robot Adventure", svg: `
      <rect class="p" x="300" y="250" width="200" height="250" rx="20"/> <rect class="p" x="340" y="100" width="120" height="120" rx="20"/> <rect class="p" x="320" y="280" width="160" height="100" rx="10"/> <circle class="p" cx="370" cy="160" r="15"/> <circle class="p" cx="430" cy="160" r="15"/>
      <rect class="p" x="200" y="280" width="80" height="30" rx="5"/> <rect class="p" x="520" y="280" width="80" height="30" rx="5"/> <path class="detail-lines" d="M340 310 h120 M340 330 h120 M340 350 h120"/>
    `}
  ];

  function init() {
    const pal = document.getElementById('palette');
    COLORS.forEach(c => {
      const sw = document.createElement('div');
      sw.className = 'color-circle' + (c === pen ? ' active' : '');
      sw.style.backgroundColor = c;
      sw.onclick = () => {
        document.querySelectorAll('.color-circle').forEach(s => s.classList.remove('active'));
        sw.classList.add('active');
        pen = c;
        playTone(500, 'sine', 0.1);
      };
      pal.appendChild(sw);
    });

    const g = document.getElementById('gal');
    SCENES.forEach((s, i) => {
      const card = document.createElement('div');
      card.className = 'art-card';
      card.innerHTML = `<svg viewBox="0 0 800 600">${s.svg}</svg><p align="center"><b>${s.name}</b></p>`;
      card.onclick = () => load(i);
      g.appendChild(card);
    });
    load(0);
  }

  function load(idx) {
    const s = document.getElementById('stage');
    s.innerHTML = `<svg viewBox="0 0 800 600">${SCENES[idx].svg}</svg>`;
    document.getElementById('gal').classList.add('hidden');
    s.querySelectorAll('.p').forEach(part => {
      part.onclick = (e) => {
        e.stopPropagation();
        part.style.fill = pen;
        brushSound();
      };
    });
  }

  function showGal() { document.getElementById('gal').classList.remove('hidden'); }

  function magicFill() {
    document.querySelectorAll('.p').forEach(p => {
      p.style.fill = COLORS[Math.floor(Math.random()*COLORS.length)];
    });
    playTone(800, 'triangle', 0.3);
  }

  // --- PRO AUDIO ENGINE ---
  function getA() {
    if (!aCtx) aCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (aCtx.state === 'suspended') aCtx.resume();
    return aCtx;
  }

  function playTone(f, type, d) {
    const ctx = getA();
    const osc = ctx.createOscillator();
    const g = ctx.createGain();
    osc.type = type; osc.frequency.value = f;
    g.gain.setValueAtTime(0.1, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + d);
    osc.connect(g); g.connect(ctx.destination);
    osc.start(); osc.stop(ctx.currentTime + d);
  }

  function brushSound() {
    const ctx = getA();
    const bSize = ctx.sampleRate * 0.2;
    const buf = ctx.createBuffer(1, bSize, ctx.sampleRate);
    const data = buf.getChannelData(0);
    for (let i = 0; i < bSize; i++) data[i] = Math.random() * 2 - 1;
    const src = ctx.createBufferSource();
    src.buffer = buf;
    const fil = ctx.createBiquadFilter();
    fil.type = 'lowpass'; fil.frequency.setValueAtTime(800, ctx.currentTime);
    fil.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.2);
    const g = ctx.createGain();
    g.gain.setValueAtTime(0.06, ctx.currentTime);
    g.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.2);
    src.connect(fil); fil.connect(g); g.connect(ctx.destination);
    src.start();
  }

  function toggleMusic() {
    getA();
    musicOn = !musicOn;
    document.getElementById('mu-btn').innerText = musicOn ? "ðŸŽµ Music: On" : "ðŸŽµ Music: Off";
    if (musicOn) loop();
  }

  function loop() {
    if (!musicOn) return;
    const ctx = getA();
    const scale = [261.6, 329.6, 392.0, 440.0];
    playTone(scale[Math.floor(Math.random()*scale.length)], 'sine', 1.2);
    setTimeout(loop, 750);
  }

  init();
</script>
</body>
</html>

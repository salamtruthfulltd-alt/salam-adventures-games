<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
  <title>Magic Tap: Ultimate Edition</title>
  <style>
    :root {
      --rainbow: linear-gradient(45deg, #ff0000, #ffea00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000);
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
    body { 
      margin: 0; padding: 10px; background: #e2e8f0; 
      font-family: 'system-ui', sans-serif;
      display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden;
    }

    /* CHUNKY 3D CASE WITH NEON GLOW */
    .console-3d {
      width: 100%; max-width: 950px; height: 95vh;
      background: #ffffff; padding: 12px; border-radius: 50px;
      position: relative;
      box-shadow: 
        0 15px 0 #cbd5e1, 
        0 25px 50px rgba(0,0,0,0.2),
        inset 0 0 20px rgba(0,0,0,0.05);
      border: 8px solid transparent;
      background-image: linear-gradient(white, white), var(--rainbow);
      background-origin: border-box; background-clip: content-box, border-box;
      display: flex; flex-direction: column;
    }

    .screen {
      background: white; border-radius: 35px; flex: 1;
      display: flex; flex-direction: column; overflow: hidden;
      box-shadow: inset 0 8px 15px rgba(0,0,0,0.1);
      border: 4px solid #f1f5f9; position: relative;
    }

    header {
      padding: 10px 25px; background: #fff; border-bottom: 2px solid #f1f5f9;
      display: flex; justify-content: space-between; align-items: center;
    }
    .btn {
      padding: 10px 18px; border: none; border-radius: 15px; font-weight: 800; cursor: pointer;
      background: #f8fafc; box-shadow: 0 4px 0 #e2e8f0; transition: 0.1s;
    }
    .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #e2e8f0; }

    /* VIEWPORT */
    .viewport { flex: 1; display: flex; align-items: center; justify-content: center; padding: 15px; }
    svg { width: 100%; height: 100%; max-height: 55vh; }
    
    /* PRO ILLUSTRATION PATHS */
    .p { fill: #fff; stroke: #1e293b; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; cursor: pointer; transition: fill 0.2s; }
    .p:hover { stroke: #3b82f6; stroke-width: 3.5; }
    .det { fill: none; stroke: #94a3b8; stroke-width: 1; pointer-events: none; opacity: 0.5; }

    /* RECESSED 3D PALETTE */
    .tray {
      background: #f1f5f9; padding: 15px; border-radius: 0 0 35px 35px;
      display: flex; flex-direction: column; align-items: center; gap: 10px;
    }
    .swatches { display: flex; gap: 8px; overflow-x: auto; width: 100%; justify-content: center; padding: 5px; }
    .swatch {
      min-width: 45px; height: 45px; border-radius: 12px; border: 3px solid white;
      cursor: pointer; box-shadow: 0 4px 0 #cbd5e1;
    }
    .swatch.active { transform: translateY(2px); box-shadow: 0 1px 0 #cbd5e1; border-color: #3b82f6; }

    #gal { position: absolute; inset: 0; background: white; z-index: 100; padding: 20px; overflow-y: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="console-3d">
  <div class="screen">
    <header>
      <div style="font-weight:900; color:#334155">MAGIC TAP <span>PRO</span></div>
      <button class="btn" onclick="openGal()" style="background:#3b82f6; color:white; box-shadow:0 4px 0 #1d4ed8;">CHANGE IMAGE</button>
    </header>

    <div id="gal" class="hidden"></div>
    <div class="viewport" id="view"></div>

    <div class="tray">
      <div class="swatches" id="swatches"></div>
      <div style="display:flex; gap:10px; width:100%; justify-content:center">
         <button class="btn" onclick="reset()">ðŸ”„ Clear</button>
         <button class="btn" onclick="toggleMusic()" id="m-btn">ðŸŽµ Music: Off</button>
      </div>
    </div>
  </div>
</div>

<script>
  const COLS = ['#FF3B30', '#FF9500', '#FFCC00', '#4CD964', '#5AC8FA', '#007AFF', '#5856D6', '#FF2D55', '#8E8E93', '#FFFFFF'];
  let pen = COLS[0], aCtx = null, mus = false;

  const SCENES = [
    { name: "Flower Garden", svg: `
      <path class="p" d="M100 550 q300-50 600 0 v50 h-600 z"/>
      <path class="p" d="M385 400 v150 h30 v-150 z"/>
      <circle class="p" cx="400" cy="300" r="60"/>
      <path class="p" d="M400 240 q80-100 120 0 t-120 60"/> <path class="p" d="M400 240 q-80-100-120 0 t120 60"/>
      <path class="p" d="M460 300 q100-80 100 60 t-160 0"/> <path class="p" d="M340 300 q-100-80-100 60 t160 0"/>
      <path class="p" d="M400 360 q80 100 120 0 t-120-60"/> <path class="p" d="M400 360 q-80 100-120 0 t120-60"/>
      <path class="p" d="M150 480 q50-80 100 0 t-100 80"/>
      <path class="det" d="M380 280 a5 5 0 1 1 10 0 M410 280 a5 5 0 1 1 10 0 M380 310 q20 15 40 0"/>
    `},
    { name: "Fish in Sea", svg: `
      <path class="p" d="M200 300 q200-200 450 0 c150 150 0 250-100 100 l100 100 v-200 l-100 100 q-250 150-350-100 z"/>
      <circle class="p" cx="300" cy="270" r="20"/>
      <path class="p" d="M450 200 q50-80 100 0"/> <path class="p" d="M450 400 q50 80 100 0"/>
      <circle class="p" cx="150" cy="150" r="25"/> <circle class="p" cx="220" cy="80" r="15"/>
      <path class="p" d="M100 500 q100-200 150 0 t-150 100 z"/>
      <path class="det" d="M350 300 h200 M360 330 h180 M370 360 h160"/>
    `},
    { name: "Magic Castle", svg: `
      <path class="p" d="M150 500 h500 v-250 h-500 z"/>
      <path class="p" d="M180 250 v-150 h120 v150 z"/> <path class="p" d="M500 250 v-150 h120 v150 z"/>
      <path class="p" d="M170 100 l70-80 l70 80 z"/> <path class="p" d="M490 100 l70-80 l70 80 z"/>
      <path class="p" d="M340 500 v-140 q60-80 120 0 v140 z"/>
      <rect class="p" x="210" y="280" width="60" height="60" rx="10"/>
      <rect class="p" x="530" y="280" width="60" height="60" rx="10"/>
      <circle class="p" cx="720" cy="100" r="50"/>
    `},
    { name: "Rocket Sky", svg: `
      <path class="p" d="M400 40 c150 0 150 400 150 500 h-300 c0-100 0-500 150-500 z"/>
      <circle class="p" cx="400" cy="220" r="60"/>
      <path class="p" d="M280 450 l-120 120 h120 z"/> <path class="p" d="M520 450 l120 120 h-120 z"/>
      <path class="p" d="M150 100 l15-15 l15 15 l-15 15 z"/> <path class="p" d="M700 200 l25-25 l25 25 l-25 25 z"/> <path class="p" d="M100 350 q50-60 100 0 t100 0 t100 0 h-300 z"/> <path class="p" d="M600 50 l30-30 l30 30 l-30 30 z"/> `}
  ];

  function init() {
    const sw = document.getElementById('swatches');
    COLS.forEach(c => {
      const d = document.createElement('div');
      d.className = 'swatch' + (c === pen ? ' active' : '');
      d.style.backgroundColor = c;
      d.onclick = () => {
        document.querySelectorAll('.swatch').forEach(s => s.classList.remove('active'));
        d.classList.add('active');
        pen = c;
        play(600, 0.05);
      };
      sw.appendChild(d);
    });

    const g = document.getElementById('gal');
    SCENES.forEach((s, i) => {
      const c = document.createElement('div');
      c.className = "btn"; c.style.height = "120px";
      c.innerHTML = `<svg viewBox="0 0 800 600">${s.svg}</svg><div>${s.name}</div>`;
      c.onclick = () => load(i);
      g.appendChild(c);
    });
    load(0);
  }

  function load(idx) {
    const v = document.getElementById('view');
    v.innerHTML = `<svg viewBox="0 0 800 600" id="current-svg">${SCENES[idx].svg}</svg>`;
    document.getElementById('gal').classList.add('hidden');
    v.querySelectorAll('.p').forEach(p => {
      p.onclick = (e) => { e.stopPropagation(); p.style.fill = pen; hiss(); };
    });
  }

  function openGal() { document.getElementById('gal').classList.remove('hidden'); }
  function reset() { document.querySelectorAll('#current-svg .p').forEach(p => p.style.fill = "#fff"); }

  function getCtx() {
    if (!aCtx) aCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (aCtx.state === 'suspended') aCtx.resume();
    return aCtx;
  }

  function play(f, d) {
    const c = getCtx();
    const o = c.createOscillator(); const g = c.createGain();
    o.frequency.value = f; g.gain.setValueAtTime(0.1, c.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, c.currentTime + d);
    o.connect(g); g.connect(c.destination);
    o.start(); o.stop(c.currentTime + d);
  }

  function hiss() {
    const c = getCtx();
    const b = c.createBuffer(1, c.sampleRate * 0.1, c.sampleRate);
    const d = b.getChannelData(0);
    for (let i = 0; i < b.length; i++) d[i] = Math.random() * 2 - 1;
    const s = c.createBufferSource(); s.buffer = b;
    const f = c.createBiquadFilter(); f.type = 'lowpass'; f.frequency.value = 1000;
    const g = c.createGain(); g.gain.setValueAtTime(0.05, c.currentTime);
    g.gain.linearRampToValueAtTime(0, c.currentTime + 0.1);
    s.connect(f); f.connect(g); g.connect(c.destination);
    s.start();
  }

  function toggleMusic() {
    getCtx(); mus = !mus;
    document.getElementById('m-btn').innerText = mus ? "ðŸŽµ Music: On" : "ðŸŽµ Music: Off";
    if (mus) loop();
  }

  function loop() {
    if (!mus) return;
    play([329, 392, 440, 523][Math.floor(Math.random()*4)], 1.5);
    setTimeout(loop, 900);
  }

  init();
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<style>
  :root { --neon: #00f2ff; --pink: #ff00de; --gold: #ffcc00; --bg: #050505; }
  body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; overflow: hidden; }
  
  #game-container {
    border: 6px solid var(--neon);
    padding: 25px; border-radius: 20px; background: #111;
    text-align: center; width: 450px; animation: borderFlash 2s infinite;
  }
  @keyframes borderFlash {
    0%, 100% { border-color: var(--neon); box-shadow: 0 0 15px var(--neon); }
    50% { border-color: var(--pink); box-shadow: 0 0 30px var(--pink); }
  }

  .stats-bar { display: flex; justify-content: space-around; background: #222; padding: 10px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #444; }
  .timer-warn { color: #ff4444; animation: shake 0.2s infinite; font-size: 1.5rem; font-weight: bold; }
  @keyframes shake { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(5px); } }

  .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
  .color-btn { padding: 15px; border-radius: 8px; border: 2px solid white; font-weight: bold; font-size: 1.1rem; cursor: pointer; text-transform: uppercase; }
  
  #display-word { font-size: 3.5rem; font-weight: 900; margin: 20px 0; text-shadow: 2px 2px #000; }
  #bonus-btn { background: var(--gold); color: black; padding: 10px; border-radius: 5px; font-weight: bold; margin-bottom: 10px; border:none; cursor: pointer;}
  #bonus-btn:disabled { opacity: 0.3; }

  #leaderboard { margin-top: 20px; width: 100%; font-size: 0.8rem; height: 150px; overflow-y: auto; }
  table { width: 100%; border-collapse: collapse; }
  th { border-bottom: 1px solid #444; color: var(--neon); }
</style>
</head>
<body onload="updateScoreboard()">

<div id="game-container">
  <h1 style="margin:0">LVL <span id="lvl-display">1</span></h1>
  <p id="mode-text" style="color: var(--gold); font-weight: bold;">MATH MULTIPLIER</p>
  
  <div class="stats-bar">
    <div>‚è≥ <span id="timer">30</span>s</div>
    <div>üéØ <span id="score">0</span>/5</div>
  </div>

  <button id="bonus-btn" onclick="useBonus()">‚òÖ SKIP ‚òÖ</button>

  <div id="puzzle-area">
    <div id="content">
      <button onclick="startGame()" style="font-size: 1.5rem; background: var(--neon); color: black; padding: 20px 40px; border:none; border-radius:10px; cursor:pointer;">START MISSION</button>
    </div>
  </div>

  <div id="leaderboard">
    <strong>TOP 20 CHALLENGERS</strong>
    <table id="score-table"><thead><tr><th>#</th><th>Name</th><th>Level</th></tr></thead><tbody id="score-body"></tbody></table>
  </div>
</div>

<script>
  let sfxOn = true; 
  let score = 0, level = 1, timeLeft = 30, goal = 5;
  let timerId = null, currentAns = "";
  const colors = ["RED", "BLUE", "GREEN", "YELLOW"];
  const colorValues = { "RED": "#ff4444", "BLUE": "#4444ff", "GREEN": "#44ff44", "YELLOW": "#ffff44" };

  function playBeep(f, d) {
    let ctx = new (window.AudioContext || window.webkitAudioContext)();
    let osc = ctx.createOscillator();
    let g = ctx.createGain();
    osc.frequency.value = f;
    osc.connect(g); g.connect(ctx.destination);
    osc.start(); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + d);
    osc.stop(ctx.currentTime + d);
  }

  function startGame() {
    score = 0; level = 1; timeLeft = 30; goal = 5;
    document.getElementById('lvl-display').innerText = level;
    document.getElementById('bonus-btn').disabled = false;
    nextPuzzle();
    startTimer();
  }

  function startTimer() {
    if(timerId) clearInterval(timerId);
    timerId = setInterval(() => {
      timeLeft--;
      document.getElementById('timer').innerText = timeLeft;
      if(timeLeft <= 5) {
        document.getElementById('timer').classList.add('timer-warn');
        playBeep(200, 0.1); 
      }
      if(timeLeft <= 0) gameOver();
    }, 1000);
  }

  function nextPuzzle() {
    document.getElementById('score').innerText = score;
    const area = document.getElementById('content');
    
    if (level === 1) {
      document.getElementById('mode-text').innerText = "PHASE 1: MATH MULTIPLIER";
      let a = Math.floor(Math.random() * 8) + 2;
      let b = Math.floor(Math.random() * 5) + 2;
      currentAns = a * b;
      area.innerHTML = `<h3>Solve:</h3><div style="font-size:2rem">${a} x ${b}</div><br>
                        <input type="number" id="user-in" style="font-size:2rem; width:80px; text-align:center;" autofocus onkeydown="if(event.key==='Enter') check()">`;
      document.getElementById('user-in').focus();
    } 
    else {
      document.getElementById('mode-text').innerText = "PHASE 2: COLOR CLASH";
      document.getElementById('mode-text').style.color = var(--pink);
      
      let wordIndex = Math.floor(Math.random() * colors.length);
      let colorIndex = Math.floor(Math.random() * colors.length);
      
      // Ensure color and word are different for the challenge
      if(colorIndex === wordIndex) colorIndex = (colorIndex + 1) % colors.length;
      
      currentAns = colors[colorIndex]; // The answer is the COLOR you see, not the word
      
      area.innerHTML = `<h3>Click the COLOR you see:</h3>
                        <div id="display-word" style="color:${colorValues[colors[colorIndex]]}">${colors[wordIndex]}</div>
                        <div class="btn-grid">
                          ${colors.map(c => `<button class="color-btn" onclick="checkColor('${c}')" style="background:${colorValues[c]}; color:black;">${c}</button>`).join('')}
                        </div>`;
    }
  }

  function check() {
    let val = document.getElementById('user-in').value;
    if(val == currentAns) success();
    else fail();
  }

  function checkColor(choice) {
    if(choice === currentAns) success();
    else fail();
  }

  function success() {
    score++;
    playBeep(600, 0.1);
    if(score >= goal) nextLevel();
    else nextPuzzle();
  }

  function fail() {
    playBeep(100, 0.2);
    if(level === 1) document.getElementById('user-in').value = "";
  }

  function nextLevel() {
    level++;
    score = 0;
    goal = 8;
    timeLeft += 15;
    document.getElementById('lvl-display').innerText = level;
    playBeep(880, 0.4);
    alert("LEVEL UP! NEW CHALLENGE UNLOCKED!");
    nextPuzzle();
  }

  function useBonus() {
    score++;
    document.getElementById('bonus-btn').disabled = true;
    if(score >= goal) nextLevel(); else nextPuzzle();
  }

  function gameOver() {
    clearInterval(timerId);
    playBeep(50, 1);
    const name = prompt(`TIME EXPIRED! Final Level: ${level}. Enter Name:`);
    if(name) saveScore(name, level);
    document.getElementById('content').innerHTML = `<button onclick="startGame()" style="padding:15px; cursor:pointer;">PLAY AGAIN</button>`;
    document.getElementById('timer').classList.remove('timer-warn');
  }

  function saveScore(name, lvl) {
    let scores = JSON.parse(localStorage.getItem('puzzleScores') || '[]');
    scores.push({name: name.substring(0,10), lvl: lvl});
    scores.sort((a,b) => b.lvl - a.lvl);
    localStorage.setItem('puzzleScores', JSON.stringify(scores.slice(0, 20)));
    updateScoreboard();
  }

  function updateScoreboard() {
    const scores = JSON.parse(localStorage.getItem('puzzleScores') || '[]');
    document.getElementById('score-body').innerHTML = scores.map((s, i) => 
      `<tr><td>${i+1}</td><td>${s.name}</td><td>${s.lvl}</td></tr>`
    ).join('');
  }
</script>
</body>
</html>
